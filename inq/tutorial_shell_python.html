<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>5. Tutorial (Shell and Python) &mdash; INQ 0.95 documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/lammps.css" type="text/css" />
      <link rel="stylesheet" href="_static/tabs.css" type="text/css" />
    <link rel="shortcut icon" href="_static/inq_favicon.ico"/>
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="_static/jquery.js?v=5d32c60e"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js?v=1c4172e4"></script>
        <script src="_static/doctools.js?v=888ff710"></script>
        <script src="_static/sphinx_highlight.js?v=4825356b"></script>
        <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
        <script src="_static/tabs.js?v=3030b3cb"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="6. Tutorial (C++)" href="tutorial_cpp.html" />
    <link rel="prev" title="4. Interface" href="interface.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html">
            
              <img src="_static/inq_logo.png" class="logo" alt="Logo"/>
          </a>
            <div class="lammps_version">Version: <b></b></div>
            <div class="lammps_release">git info: 0.95</div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">User Guide</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="introduction.html">1. README</a><ul>
<li class="toctree-l2"><a class="reference internal" href="introduction.html#components">1.1. Components</a></li>
<li class="toctree-l2"><a class="reference internal" href="introduction.html#basic-installation">1.2. Basic installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="introduction.html#reference">1.3. Reference</a></li>
<li class="toctree-l2"><a class="reference internal" href="introduction.html#introductory-material">1.4. Introductory material</a></li>
<li class="toctree-l2"><a class="reference internal" href="introduction.html#release-information">1.5. Release information</a></li>
<li class="toctree-l2"><a class="reference internal" href="introduction.html#acknowledgment">1.6. Acknowledgment</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="compilation.html">2. Compilation and installation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="compilation.html#compiling-and-running-on-a-local-computer">2.1. Compiling and running on a local computer</a><ul>
<li class="toctree-l3"><a class="reference internal" href="compilation.html#install-dependencies-and-setup-environment">2.1.1. Install dependencies and setup environment</a></li>
<li class="toctree-l3"><a class="reference internal" href="compilation.html#clone-repository">2.1.2. Clone repository</a></li>
<li class="toctree-l3"><a class="reference internal" href="compilation.html#for-cpu-only-system">2.1.3. For CPU-only system</a></li>
<li class="toctree-l3"><a class="reference internal" href="compilation.html#for-an-nvidia-gpu-system-with-nvcc-11-x">2.1.4. For an Nvidia-GPU system (with NVCC 11.x)</a></li>
<li class="toctree-l3"><a class="reference internal" href="compilation.html#specific-computers">2.1.5. Specific computers</a></li>
<li class="toctree-l3"><a class="reference internal" href="compilation.html#manually-setting-utilization-of-multiple-gpu-with-mpi">2.1.6. Manually setting utilization of multiple GPU with MPI</a></li>
<li class="toctree-l3"><a class="reference internal" href="compilation.html#installing-gcc-for-cuda">2.1.7. Installing GCC for CUDA</a></li>
<li class="toctree-l3"><a class="reference internal" href="compilation.html#mac-os-14">2.1.8. Mac OS 14</a></li>
<li class="toctree-l3"><a class="reference internal" href="compilation.html#recover-from-nvidia-device-error">2.1.9. Recover from Nvidia device error</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="compilation.html#compiling-inq-on-supercomputing-clusters">2.2. Compiling INQ on Supercomputing Clusters</a><ul>
<li class="toctree-l3"><a class="reference internal" href="compilation.html#compiling-on-perlmutter-at-nersc">2.2.1. Compiling on Perlmutter at NERSC</a></li>
<li class="toctree-l3"><a class="reference internal" href="compilation.html#compiling-on-lbnl-generic-linux-supercluster">2.2.2. Compiling on LBNL Generic Linux Supercluster</a></li>
<li class="toctree-l3"><a class="reference internal" href="compilation.html#compiling-on-frontera-at-tacc-fhj-9-26-22">2.2.3. Compiling on Frontera at TACC (FHJ, 9/26/22)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="compilation.html#running-test-jobs">Running test jobs</a></li>
<li class="toctree-l4"><a class="reference internal" href="compilation.html#compiling-and-running-on-frontier">Compiling and running on Frontier</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="compilation.html#alcf-polaris">2.2.4. ALCF Polaris</a></li>
<li class="toctree-l3"><a class="reference internal" href="compilation.html#llnl-sierra-lassen">2.2.5. LLNL Sierra/Lassen</a><ul>
<li class="toctree-l4"><a class="reference internal" href="compilation.html#environment">Environment</a></li>
<li class="toctree-l4"><a class="reference internal" href="compilation.html#configuration">Configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="compilation.html#build-install-and-test">Build, Install and Test</a></li>
<li class="toctree-l4"><a class="reference internal" href="compilation.html#open-a-shell-in-a-node">Open a shell in a node</a></li>
<li class="toctree-l4"><a class="reference internal" href="compilation.html#running-interactively">Running interactively</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="compilation.html#llnl-tioga-amd">2.2.6. LLNL Tioga (AMD)</a></li>
<li class="toctree-l3"><a class="reference internal" href="compilation.html#olcf-frontier-amd">2.2.7. OLCF Frontier (AMD)</a></li>
<li class="toctree-l3"><a class="reference internal" href="compilation.html#nersc-perlmutter-nvidia">2.2.8. NERSC Perlmutter (NVIDIA)</a></li>
<li class="toctree-l3"><a class="reference internal" href="compilation.html#quartz">2.2.9. Quartz</a><ul>
<li class="toctree-l4"><a class="reference internal" href="compilation.html#environment">Environment</a></li>
<li class="toctree-l4"><a class="reference internal" href="compilation.html#configuration">Configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="compilation.html#build-install-and-test">Build, Install and Test</a></li>
<li class="toctree-l4"><a class="reference internal" href="compilation.html#open-a-shell-in-a-node">Open a shell in a node</a></li>
<li class="toctree-l4"><a class="reference internal" href="compilation.html#running-interactively">Running interactively</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="compilation.html#compiling-parallel-mpi-hdf5-for-inq">2.3. Compiling Parallel (MPI) HDF5 for INQ</a></li>
<li class="toctree-l2"><a class="reference internal" href="compilation.html#cmake">2.4. CMake</a></li>
<li class="toctree-l2"><a class="reference internal" href="compilation.html#boost">2.5. BOOST</a><ul>
<li class="toctree-l3"><a class="reference internal" href="compilation.html#install-boost-libraries">2.5.1. Install BOOST libraries</a></li>
<li class="toctree-l3"><a class="reference internal" href="compilation.html#install-boost">2.5.2. Install BOOST</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="theory.html">3. Theory</a><ul>
<li class="toctree-l2"><a class="reference internal" href="theory.html#total-energy">3.1. Total energy</a></li>
<li class="toctree-l2"><a class="reference internal" href="theory.html#pseudopotential-application">3.2. Pseudopotential application</a></li>
<li class="toctree-l2"><a class="reference internal" href="theory.html#k-points">3.3. k-points</a></li>
<li class="toctree-l2"><a class="reference internal" href="theory.html#hartree-fock-with-k-points">3.4. Hartree-Fock with k-points</a></li>
<li class="toctree-l2"><a class="reference internal" href="theory.html#electric-fields-and-gauges">3.5. Electric fields and gauges</a></li>
<li class="toctree-l2"><a class="reference internal" href="theory.html#coordinates">3.6. Coordinates</a><ul>
<li class="toctree-l3"><a class="reference internal" href="theory.html#mini-cell-circumscribing-a-sphere">3.6.1. Mini cell circumscribing a sphere</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="theory.html#preconditioner">3.7. Preconditioner</a></li>
<li class="toctree-l2"><a class="reference internal" href="theory.html#exact-factorization">3.8. Exact factorization</a><ul>
<li class="toctree-l3"><a class="reference internal" href="theory.html#nuclear-eom">3.8.1. Nuclear EOM</a></li>
<li class="toctree-l3"><a class="reference internal" href="theory.html#electronic-equation-of-motion">3.8.2. Electronic equation of motion</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="theory.html#self-consistency-acceleration">3.9. Self-consistency acceleration</a></li>
<li class="toctree-l2"><a class="reference internal" href="theory.html#magnetization">3.10. Magnetization</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="interface.html">4. Interface</a><ul>
<li class="toctree-l2"><a class="reference internal" href="interface.html#the-cell-command">4.1. The ‘cell’ command</a></li>
<li class="toctree-l2"><a class="reference internal" href="interface.html#the-clear-command">4.2. The ‘clear’ command</a></li>
<li class="toctree-l2"><a class="reference internal" href="interface.html#the-electrons-command">4.3. The ‘electrons’ command</a></li>
<li class="toctree-l2"><a class="reference internal" href="interface.html#the-ground-state-command">4.4. The ‘ground-state’ command</a></li>
<li class="toctree-l2"><a class="reference internal" href="interface.html#the-history-command">4.5. The ‘history’ command</a></li>
<li class="toctree-l2"><a class="reference internal" href="interface.html#the-ions-command">4.6. The ‘ions’ command</a></li>
<li class="toctree-l2"><a class="reference internal" href="interface.html#the-kpoints-command">4.7. The ‘kpoints’ command</a></li>
<li class="toctree-l2"><a class="reference internal" href="interface.html#the-perturbations-command">4.8. The ‘perturbations’ command</a></li>
<li class="toctree-l2"><a class="reference internal" href="interface.html#the-real-time-command">4.9. The ‘real-time’ command</a></li>
<li class="toctree-l2"><a class="reference internal" href="interface.html#results">4.10. Results</a></li>
<li class="toctree-l2"><a class="reference internal" href="interface.html#the-results-ground-state-command">4.11. The ‘results ground-state’ command</a></li>
<li class="toctree-l2"><a class="reference internal" href="interface.html#the-results-real-time-command">4.12. The ‘results real-time’ command</a></li>
<li class="toctree-l2"><a class="reference internal" href="interface.html#the-run-command">4.13. The ‘run’ command</a></li>
<li class="toctree-l2"><a class="reference internal" href="interface.html#the-species-command">4.14. The ‘species’ command</a></li>
<li class="toctree-l2"><a class="reference internal" href="interface.html#the-spectrum-command">4.15. The ‘spectrum’ command</a></li>
<li class="toctree-l2"><a class="reference internal" href="interface.html#the-status-command">4.16. The ‘status’ command</a></li>
<li class="toctree-l2"><a class="reference internal" href="interface.html#the-theory-command">4.17. The ‘theory’ command</a></li>
<li class="toctree-l2"><a class="reference internal" href="interface.html#units-in-inq">4.18. Units in inq</a></li>
<li class="toctree-l2"><a class="reference internal" href="interface.html#the-util-command">4.19. The ‘util’ command</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">5. Tutorial (Shell and Python)</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#nitrogen-molecule">5.1. Nitrogen molecule</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#setting-up-the-run-directory">5.1.1. Setting up the run directory</a></li>
<li class="toctree-l3"><a class="reference internal" href="#defining-the-simulation-parameters">5.1.2. Defining the simulation parameters</a></li>
<li class="toctree-l3"><a class="reference internal" href="#running-the-simulation">5.1.3. Running the simulation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#querying-the-ground-state-results">5.1.4. Querying the ground-state results</a></li>
<li class="toctree-l3"><a class="reference internal" href="#changing-the-ion-positions">5.1.5. Changing the ion positions</a></li>
<li class="toctree-l3"><a class="reference internal" href="#scripting-the-potential-energy-surface-of-n2">5.1.6. Scripting: the potential energy surface of N2</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#benzene-optical-absorption-spectrum">5.2. Benzene optical absorption spectrum</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#simulation-parameters">5.2.1. Simulation parameters</a></li>
<li class="toctree-l3"><a class="reference internal" href="#ground-state-calculation">5.2.2. Ground state calculation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#first-time-propagation-finding-the-optimal-time-step">5.2.3. First time propagation, finding the optimal time-step</a></li>
<li class="toctree-l3"><a class="reference internal" href="#adding-a-perturbation">5.2.4. Adding a perturbation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#defining-the-observables">5.2.5. Defining the observables</a></li>
<li class="toctree-l3"><a class="reference internal" href="#run-the-propagation">5.2.6. Run the propagation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#analyzing-the-results-and-obtaining-the-spectrum">5.2.7. Analyzing the results and obtaining the spectrum</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="tutorial_cpp.html">6. Tutorial (C++)</a><ul>
<li class="toctree-l2"><a class="reference internal" href="tutorial_cpp.html#nitrogen-molecule">6.1. Nitrogen molecule</a><ul>
<li class="toctree-l3"><a class="reference internal" href="tutorial_cpp.html#header">6.1.1. Header</a></li>
<li class="toctree-l3"><a class="reference internal" href="tutorial_cpp.html#electronic-system">6.1.2. Electronic system</a></li>
<li class="toctree-l3"><a class="reference internal" href="tutorial_cpp.html#single-point-energy-calculation">6.1.3. Single point energy calculation</a></li>
<li class="toctree-l3"><a class="reference internal" href="tutorial_cpp.html#potential-energy-surface">6.1.4. Potential energy surface</a></li>
<li class="toctree-l3"><a class="reference internal" href="tutorial_cpp.html#finding-the-minimum-energy-advanced">6.1.5. Finding the minimum energy (advanced)</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="tutorial_cpp.html#hydrogen-fluoride-molecule">6.2. Hydrogen fluoride molecule</a><ul>
<li class="toctree-l3"><a class="reference internal" href="tutorial_cpp.html#partial-charges">6.2.1. Partial charges</a></li>
<li class="toctree-l3"><a class="reference internal" href="tutorial_cpp.html#hartee-fock">6.2.2. Hartee-Fock</a></li>
<li class="toctree-l3"><a class="reference internal" href="tutorial_cpp.html#parallelization">6.2.3. Parallelization</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="tutorial_cpp.html#benzene-optical-absorption-spectrum">6.3. Benzene optical absorption spectrum</a><ul>
<li class="toctree-l3"><a class="reference internal" href="tutorial_cpp.html#first-time-propagation-finding-the-optimal-time-step">6.3.1. First time propagation, finding the optimal time-step</a></li>
<li class="toctree-l3"><a class="reference internal" href="tutorial_cpp.html#adding-a-perturbation-and-observables">6.3.2. Adding a perturbation and observables</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="tutorial_cpp.html#electronic-stopping">6.4. Electronic stopping</a><ul>
<li class="toctree-l3"><a class="reference internal" href="tutorial_cpp.html#aluminum-supercell">6.4.1. Aluminum supercell</a></li>
<li class="toctree-l3"><a class="reference internal" href="tutorial_cpp.html#adding-a-proton">6.4.2. Adding a proton</a></li>
<li class="toctree-l3"><a class="reference internal" href="tutorial_cpp.html#ground-state-calculation">6.4.3. Ground state calculation</a></li>
<li class="toctree-l3"><a class="reference internal" href="tutorial_cpp.html#time-propagation">6.4.4. Time propagation</a></li>
<li class="toctree-l3"><a class="reference internal" href="tutorial_cpp.html#results">6.4.5. Results</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="developers_guide.html">7. Developers Guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="developers_guide.html#repository">7.1. Repository</a></li>
<li class="toctree-l2"><a class="reference internal" href="developers_guide.html#coding">7.2. Coding</a></li>
<li class="toctree-l2"><a class="reference internal" href="developers_guide.html#debugging-code">7.3. Debugging code</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="reference_magnitude.html">inq::magnitude</a><ul>
<li class="toctree-l2"><a class="reference internal" href="reference_magnitude.html#inq-magnitude-energy">inq::magnitude::energy</a></li>
<li class="toctree-l2"><a class="reference internal" href="reference_magnitude.html#inq-magnitude-length">inq::magnitude::length</a></li>
<li class="toctree-l2"><a class="reference internal" href="reference_magnitude.html#inq-magnitude-time">inq::magnitude::time</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="reference_systems.html">inq::systems</a><ul>
<li class="toctree-l2"><a class="reference internal" href="reference_systems.html#inq-systems-cell">inq::systems::cell</a></li>
<li class="toctree-l2"><a class="reference internal" href="reference_systems.html#inq-systems-electrons">inq::systems::electrons</a></li>
<li class="toctree-l2"><a class="reference internal" href="reference_systems.html#inq-systems-ions">inq::systems::ions</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">INQ</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content style-external-links">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active"><span class="section-number">5. </span>Tutorial (Shell and Python)</li>
      <li class="wy-breadcrumbs-aside">
          <a href="https://gitlab.com/npneq/inq"><img src="_static/gitlab.png" width="100" alt="gitlab"> </a>
      </li>
  </ul><div class="rst-breadcrumbs-buttons" role="navigation" aria-label="Sequential page navigation">
        <a href="interface.html" class="btn btn-neutral float-left" title="4. Interface" accesskey="p"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="tutorial_cpp.html" class="btn btn-neutral float-right" title="6. Tutorial (C++)" accesskey="n">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
  </div>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="tutorial-shell-and-python">
<h1><span class="section-number">5. </span>Tutorial (Shell and Python)<a class="headerlink" href="#tutorial-shell-and-python" title="Permalink to this heading"></a></h1>
<p>INQ’s command line interface takes a unique approach to run an electronic structure simulation.
The basic premise of INQ command interface is that a certain directory/folder corresponds to a specific simulation.
All commands that you run, either through a Unix shell or Python functions, are relative to the directory and are persistent (they are stored in files and outlive the run time of the commands).</p>
<p>This approach allows to do away with input files and make it simpler and much less error-prone to run a simulation; each command will give you feedback and at any time you can query the simulation parameters before running.
This strategy avoid too common situations like having a simulation job waiting for hours in a supercomputer queue, just to discover that there was a small syntax error in your input file.</p>
<p>INQ commands can be called directly from the Unix shell command line through the <cite>inq</cite> executable, or from Python using the <cite>pinq</cite> module.
Note that both ways of using the interface modify the underlying meta-data in the current folder, so it is possible to mix shell and python commands for the same simulation.
For example you can set up your simulation using a python script and then run it using the shell <cite>inq run</cite> command.</p>
<section id="nitrogen-molecule">
<h2><span class="section-number">5.1. </span>Nitrogen molecule<a class="headerlink" href="#nitrogen-molecule" title="Permalink to this heading"></a></h2>
<section id="setting-up-the-run-directory">
<h3><span class="section-number">5.1.1. </span>Setting up the run directory<a class="headerlink" href="#setting-up-the-run-directory" title="Permalink to this heading"></a></h3>
<p>We will start our tutorial by a simple molecular system calculation. We are assuming you are right now running in a Unix terminal and you have INQ installed. First, let’s create a folder for our simulation and get into it:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mkdir<span class="w"> </span>nitrogen
<span class="nb">cd</span><span class="w"> </span>nitrogen
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The basic premise of INQ command interface is that a certain directory/folder corresponds to a specific simulation. All commands that you run, either through a Unix shell or Python functions, are relative to the directory and are persistent (they are stored in files and outlive the run time of the commands).</p>
</div>
<p>This tutorial is designed to be done using either the shell command line interface or the Python interface. Instructions for both cases will be given. So just pick which one you will like to use (or you can mix and match, since both modify the persistent data in the current simulation).</p>
<p>If you are going to use Python, start the python interpreter and import the INQ module <cite>pinq</cite>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pinq</span>
</pre></div>
</div>
<p>You don’t need to do anything at this point if you are going to use the shell command. Just verify that the <cite>inq</cite> command is available. The first command we will run is <cite>clear</cite>. This command removes all INQ meta-data in the current folder. Since we just created the directory it should be empty, but let’s run it anyways.</p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-0-U2hlbGw=" aria-selected="true" class="sphinx-tabs-tab code-tab group-tab" id="tab-0-U2hlbGw=" name="U2hlbGw=" role="tab" tabindex="0">Shell</button><button aria-controls="panel-0-UHl0aG9u" aria-selected="false" class="sphinx-tabs-tab code-tab group-tab" id="tab-0-UHl0aG9u" name="UHl0aG9u" role="tab" tabindex="-1">Python</button></div><div aria-labelledby="tab-0-U2hlbGw=" class="sphinx-tabs-panel code-tab group-tab" id="panel-0-U2hlbGw=" name="U2hlbGw=" role="tabpanel" tabindex="0"><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>inq<span class="w"> </span>clear
</pre></div>
</div>
</div><div aria-labelledby="tab-0-UHl0aG9u" class="sphinx-tabs-panel code-tab group-tab" hidden="true" id="panel-0-UHl0aG9u" name="UHl0aG9u" role="tabpanel" tabindex="0"><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pinq</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
</pre></div>
</div>
</div></div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>It is a good idea to run <cite>clear</cite> each time you start a new simulation (especially if you are making a script) to get rid of all previous information that might exist in the current directory.</p>
</div>
</section>
<section id="defining-the-simulation-parameters">
<h3><span class="section-number">5.1.2. </span>Defining the simulation parameters<a class="headerlink" href="#defining-the-simulation-parameters" title="Permalink to this heading"></a></h3>
<p>Now we are ready to start setting up the simulation.
First we define a simulation cell of size 10 x 10 x 12 bohr.
This is how to do it:</p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-1-U2hlbGw=" aria-selected="true" class="sphinx-tabs-tab code-tab group-tab" id="tab-1-U2hlbGw=" name="U2hlbGw=" role="tab" tabindex="0">Shell</button><button aria-controls="panel-1-UHl0aG9u" aria-selected="false" class="sphinx-tabs-tab code-tab group-tab" id="tab-1-UHl0aG9u" name="UHl0aG9u" role="tab" tabindex="-1">Python</button></div><div aria-labelledby="tab-1-U2hlbGw=" class="sphinx-tabs-panel code-tab group-tab" id="panel-1-U2hlbGw=" name="U2hlbGw=" role="tabpanel" tabindex="0"><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>inq<span class="w"> </span>cell<span class="w"> </span>orthorhombic<span class="w"> </span><span class="m">10</span><span class="w"> </span><span class="m">10</span><span class="w"> </span><span class="m">12</span><span class="w"> </span>bohr
</pre></div>
</div>
</div><div aria-labelledby="tab-1-UHl0aG9u" class="sphinx-tabs-panel code-tab group-tab" hidden="true" id="panel-1-UHl0aG9u" name="UHl0aG9u" role="tabpanel" tabindex="0"><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pinq</span><span class="o">.</span><span class="n">cell</span><span class="o">.</span><span class="n">orthorhombic</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="s2">&quot;bohr&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div></div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>We need to explicitly tell INQ what units we will be using. This is by design, we want to avoid ambiguities in units that can cause errors (and <a class="reference external" href="https://en.wikipedia.org/wiki/Mars_Climate_Orbiter">crash spacecraft</a> ).</p>
</div>
<p>Once we defined the cell, we can query what is the cell in our simulation at any time with the following command:</p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-2-U2hlbGw=" aria-selected="true" class="sphinx-tabs-tab code-tab group-tab" id="tab-2-U2hlbGw=" name="U2hlbGw=" role="tab" tabindex="0">Shell</button><button aria-controls="panel-2-UHl0aG9u" aria-selected="false" class="sphinx-tabs-tab code-tab group-tab" id="tab-2-UHl0aG9u" name="UHl0aG9u" role="tab" tabindex="-1">Python</button></div><div aria-labelledby="tab-2-U2hlbGw=" class="sphinx-tabs-panel code-tab group-tab" id="panel-2-U2hlbGw=" name="U2hlbGw=" role="tabpanel" tabindex="0"><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>inq<span class="w"> </span>cell
</pre></div>
</div>
</div><div aria-labelledby="tab-2-UHl0aG9u" class="sphinx-tabs-panel code-tab group-tab" hidden="true" id="panel-2-UHl0aG9u" name="UHl0aG9u" role="tabpanel" tabindex="0"><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pinq</span><span class="o">.</span><span class="n">cell</span><span class="o">.</span><span class="n">status</span><span class="p">()</span>
</pre></div>
</div>
</div></div>
<p>You should get an output like this:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="nl">Cell</span><span class="p">:</span>
<span class="w">  </span><span class="n">Lattice</span><span class="w"> </span><span class="n">vectors</span><span class="w"> </span><span class="p">[</span><span class="n">b</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">10</span><span class="w">    </span><span class="mi">0</span><span class="w">       </span><span class="mi">0</span>
<span class="w">                      </span><span class="mi">0</span><span class="w">       </span><span class="mi">10</span><span class="w">      </span><span class="mi">0</span>
<span class="w">                      </span><span class="mi">0</span><span class="w">       </span><span class="mi">0</span><span class="w">       </span><span class="mi">12</span>
<span class="n">Volume</span><span class="w"> </span><span class="p">[</span><span class="n">b</span><span class="o">^</span><span class="mi">3</span><span class="p">]</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="mi">1200</span>
<span class="n">Periodicity</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="n">d</span><span class="w"> </span><span class="p">(</span><span class="n">fully</span><span class="w"> </span><span class="n">periodic</span><span class="p">)</span>
</pre></div>
</div>
<p>Query commands like this exist for most settings and can be used at any time.
It is a good practice to use them check to make sure the code is actually going to do what we want.</p>
<p>Now that the cell is defined, let’s add the atoms. This is done with the <cite>ions insert</cite> command. The following commands will insert two nitrogen atoms at a distance of 1.3 Angstrom.</p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-3-U2hlbGw=" aria-selected="true" class="sphinx-tabs-tab code-tab group-tab" id="tab-3-U2hlbGw=" name="U2hlbGw=" role="tab" tabindex="0">Shell</button><button aria-controls="panel-3-UHl0aG9u" aria-selected="false" class="sphinx-tabs-tab code-tab group-tab" id="tab-3-UHl0aG9u" name="UHl0aG9u" role="tab" tabindex="-1">Python</button></div><div aria-labelledby="tab-3-U2hlbGw=" class="sphinx-tabs-panel code-tab group-tab" id="panel-3-U2hlbGw=" name="U2hlbGw=" role="tabpanel" tabindex="0"><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>inq<span class="w"> </span>ions<span class="w"> </span>insert<span class="w"> </span>N<span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w">  </span><span class="m">1</span>.3/2<span class="w"> </span>Angstrom
inq<span class="w"> </span>ions<span class="w"> </span>insert<span class="w"> </span>N<span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w"> </span>-1.3/2<span class="w"> </span>Angstrom
</pre></div>
</div>
</div><div aria-labelledby="tab-3-UHl0aG9u" class="sphinx-tabs-panel code-tab group-tab" hidden="true" id="panel-3-UHl0aG9u" name="UHl0aG9u" role="tabpanel" tabindex="0"><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pinq</span><span class="o">.</span><span class="n">ions</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="s2">&quot;N&quot;</span><span class="p">,</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span>  <span class="mf">1.3</span><span class="o">/</span><span class="mi">2</span><span class="p">],</span> <span class="s2">&quot;Angstrom&quot;</span><span class="p">)</span>
<span class="n">pinq</span><span class="o">.</span><span class="n">ions</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="s2">&quot;N&quot;</span><span class="p">,</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.3</span><span class="o">/</span><span class="mi">2</span><span class="p">],</span> <span class="s2">&quot;Angstrom&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div></div>
<p>As you can see the inq shell command has some basic math interpretation capabilities, so we can write <cite>1.3/2</cite> and let INQ do the division.</p>
<p>Now that we defined the ions in the simulation we have to take care of the electrons.
The only parameter we really need is the plane-wave cutoff, as for other values we can rely on defaults.</p>
<p>The cutoff is set by the <cite>electrons cutoff</cite> command.
In this case we want to set a value of 40 Hartree that we do by:</p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-4-U2hlbGw=" aria-selected="true" class="sphinx-tabs-tab code-tab group-tab" id="tab-4-U2hlbGw=" name="U2hlbGw=" role="tab" tabindex="0">Shell</button><button aria-controls="panel-4-UHl0aG9u" aria-selected="false" class="sphinx-tabs-tab code-tab group-tab" id="tab-4-UHl0aG9u" name="UHl0aG9u" role="tab" tabindex="-1">Python</button></div><div aria-labelledby="tab-4-U2hlbGw=" class="sphinx-tabs-panel code-tab group-tab" id="panel-4-U2hlbGw=" name="U2hlbGw=" role="tabpanel" tabindex="0"><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>inq<span class="w"> </span>electrons<span class="w"> </span>cutoff<span class="w"> </span><span class="m">40</span>.0<span class="w"> </span>Hartree
</pre></div>
</div>
</div><div aria-labelledby="tab-4-UHl0aG9u" class="sphinx-tabs-panel code-tab group-tab" hidden="true" id="panel-4-UHl0aG9u" name="UHl0aG9u" role="tabpanel" tabindex="0"><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pinq</span><span class="o">.</span><span class="n">electrons</span><span class="o">.</span><span class="n">cutoff</span><span class="p">(</span><span class="mf">40.0</span><span class="p">,</span> <span class="s2">&quot;Hartree&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div></div>
<p>You can check the options that are set for the electrons running the following command:</p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-5-U2hlbGw=" aria-selected="true" class="sphinx-tabs-tab code-tab group-tab" id="tab-5-U2hlbGw=" name="U2hlbGw=" role="tab" tabindex="0">Shell</button><button aria-controls="panel-5-UHl0aG9u" aria-selected="false" class="sphinx-tabs-tab code-tab group-tab" id="tab-5-UHl0aG9u" name="UHl0aG9u" role="tab" tabindex="-1">Python</button></div><div aria-labelledby="tab-5-U2hlbGw=" class="sphinx-tabs-panel code-tab group-tab" id="panel-5-U2hlbGw=" name="U2hlbGw=" role="tabpanel" tabindex="0"><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>inq<span class="w"> </span>electrons
</pre></div>
</div>
</div><div aria-labelledby="tab-5-UHl0aG9u" class="sphinx-tabs-panel code-tab group-tab" hidden="true" id="panel-5-UHl0aG9u" name="UHl0aG9u" role="tabpanel" tabindex="0"><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pinq</span><span class="o">.</span><span class="n">electrons</span><span class="o">.</span><span class="n">status</span><span class="p">()</span>
</pre></div>
</div>
</div></div>
<p>This will give you an idea of the parameters available and their default values.</p>
</section>
<section id="running-the-simulation">
<h3><span class="section-number">5.1.3. </span>Running the simulation<a class="headerlink" href="#running-the-simulation" title="Permalink to this heading"></a></h3>
<p>We have now set all the parameters needed to do a ground-state calculation for nitrogen.
However, the simulation has not been done yet, we need to tell INQ to run it.
This is done with the <cite>run ground state</cite> command:</p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-6-U2hlbGw=" aria-selected="true" class="sphinx-tabs-tab code-tab group-tab" id="tab-6-U2hlbGw=" name="U2hlbGw=" role="tab" tabindex="0">Shell</button><button aria-controls="panel-6-UHl0aG9u" aria-selected="false" class="sphinx-tabs-tab code-tab group-tab" id="tab-6-UHl0aG9u" name="UHl0aG9u" role="tab" tabindex="-1">Python</button></div><div aria-labelledby="tab-6-U2hlbGw=" class="sphinx-tabs-panel code-tab group-tab" id="panel-6-U2hlbGw=" name="U2hlbGw=" role="tabpanel" tabindex="0"><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>inq<span class="w"> </span>run<span class="w"> </span>ground<span class="w"> </span>state
</pre></div>
</div>
</div><div aria-labelledby="tab-6-UHl0aG9u" class="sphinx-tabs-panel code-tab group-tab" hidden="true" id="panel-6-UHl0aG9u" name="UHl0aG9u" role="tabpanel" tabindex="0"><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pinq</span><span class="o">.</span><span class="n">run</span><span class="o">.</span><span class="n">ground_state</span><span class="p">()</span>
</pre></div>
</div>
</div></div>
<p>This should take a few seconds. At the end of the output INQ should print something like:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="n">SCF</span><span class="w"> </span><span class="n">ended</span><span class="w"> </span><span class="n">after</span><span class="w"> </span><span class="mi">54</span><span class="w"> </span><span class="n">iterations</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">resulting</span><span class="w"> </span><span class="n">eigenvalues</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">energies</span><span class="o">:</span>

<span class="n">st</span><span class="w"> </span><span class="o">=</span><span class="w">    </span><span class="mi">1</span><span class="w">  </span><span class="n">occ</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">2.000</span><span class="w">  </span><span class="n">evalue</span><span class="w"> </span><span class="o">=</span><span class="w">    </span><span class="mf">-0.916321357828</span><span class="w"> </span><span class="n">Ha</span><span class="w"> </span><span class="p">(</span><span class="w">  </span><span class="mf">-24.934371418951</span><span class="w"> </span><span class="n">eV</span><span class="p">)</span><span class="w">  </span><span class="n">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">7e-09</span>
<span class="n">st</span><span class="w"> </span><span class="o">=</span><span class="w">    </span><span class="mi">2</span><span class="w">  </span><span class="n">occ</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">2.000</span><span class="w">  </span><span class="n">evalue</span><span class="w"> </span><span class="o">=</span><span class="w">    </span><span class="mf">-0.523560815064</span><span class="w"> </span><span class="n">Ha</span><span class="w"> </span><span class="p">(</span><span class="w">  </span><span class="mf">-14.246813862499</span><span class="w"> </span><span class="n">eV</span><span class="p">)</span><span class="w">  </span><span class="n">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">3e-08</span>
<span class="n">st</span><span class="w"> </span><span class="o">=</span><span class="w">    </span><span class="mi">3</span><span class="w">  </span><span class="n">occ</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">2.000</span><span class="w">  </span><span class="n">evalue</span><span class="w"> </span><span class="o">=</span><span class="w">    </span><span class="mf">-0.356182318108</span><span class="w"> </span><span class="n">Ha</span><span class="w"> </span><span class="p">(</span><span class="w">   </span><span class="mf">-9.692213475863</span><span class="w"> </span><span class="n">eV</span><span class="p">)</span><span class="w">  </span><span class="n">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1e-08</span>
<span class="n">st</span><span class="w"> </span><span class="o">=</span><span class="w">    </span><span class="mi">4</span><span class="w">  </span><span class="n">occ</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">2.000</span><span class="w">  </span><span class="n">evalue</span><span class="w"> </span><span class="o">=</span><span class="w">    </span><span class="mf">-0.356180895755</span><span class="w"> </span><span class="n">Ha</span><span class="w"> </span><span class="p">(</span><span class="w">   </span><span class="mf">-9.692174771677</span><span class="w"> </span><span class="n">eV</span><span class="p">)</span><span class="w">  </span><span class="n">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">2e-08</span>
<span class="n">st</span><span class="w"> </span><span class="o">=</span><span class="w">    </span><span class="mi">5</span><span class="w">  </span><span class="n">occ</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">2.000</span><span class="w">  </span><span class="n">evalue</span><span class="w"> </span><span class="o">=</span><span class="w">    </span><span class="mf">-0.351473943512</span><span class="w"> </span><span class="n">Ha</span><span class="w"> </span><span class="p">(</span><span class="w">   </span><span class="mf">-9.564092091423</span><span class="w"> </span><span class="n">eV</span><span class="p">)</span><span class="w">  </span><span class="n">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">5e-08</span>

<span class="nl">Energy</span><span class="p">:</span>
<span class="w">  </span><span class="n">total</span><span class="w">          </span><span class="o">=</span><span class="w">     </span><span class="mf">-20.705372548423</span><span class="w"> </span><span class="n">Ha</span>
<span class="w">  </span><span class="n">kinetic</span><span class="w">        </span><span class="o">=</span><span class="w">      </span><span class="mf">12.720356398467</span><span class="w"> </span><span class="n">Ha</span>
<span class="w">  </span><span class="n">eigenvalues</span><span class="w">    </span><span class="o">=</span><span class="w">      </span><span class="mf">-5.007438660535</span><span class="w"> </span><span class="n">Ha</span>
<span class="w">  </span><span class="n">hartree</span><span class="w">        </span><span class="o">=</span><span class="w">      </span><span class="mf">13.547930959702</span><span class="w"> </span><span class="n">Ha</span>
<span class="w">  </span><span class="n">external</span><span class="w">       </span><span class="o">=</span><span class="w">     </span><span class="mf">-37.150127253812</span><span class="w"> </span><span class="n">Ha</span>
<span class="w">  </span><span class="n">non</span><span class="o">-</span><span class="n">local</span><span class="w">      </span><span class="o">=</span><span class="w">      </span><span class="mf">-1.418675597565</span><span class="w"> </span><span class="n">Ha</span>
<span class="w">  </span><span class="n">xc</span><span class="w">             </span><span class="o">=</span><span class="w">      </span><span class="mf">-5.731429377763</span><span class="w"> </span><span class="n">Ha</span>
<span class="w">  </span><span class="n">nvxc</span><span class="w">           </span><span class="o">=</span><span class="w">      </span><span class="mf">-6.254854127029</span><span class="w"> </span><span class="n">Ha</span>
<span class="w">  </span><span class="n">exact</span><span class="o">-</span><span class="n">exchange</span><span class="w"> </span><span class="o">=</span><span class="w">       </span><span class="mf">0.000000000000</span><span class="w"> </span><span class="n">Ha</span>
<span class="w">  </span><span class="n">ion</span><span class="w">            </span><span class="o">=</span><span class="w">      </span><span class="mf">-2.673427677451</span><span class="w"> </span><span class="n">Ha</span>
</pre></div>
</div>
</section>
<section id="querying-the-ground-state-results">
<h3><span class="section-number">5.1.4. </span>Querying the ground-state results<a class="headerlink" href="#querying-the-ground-state-results" title="Permalink to this heading"></a></h3>
<p>Now that we finished the calculation we can access the individual simulation results using commands.
The command <cite>results ground state</cite> will give us an overview of the simulation data:</p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-7-U2hlbGw=" aria-selected="true" class="sphinx-tabs-tab code-tab group-tab" id="tab-7-U2hlbGw=" name="U2hlbGw=" role="tab" tabindex="0">Shell</button><button aria-controls="panel-7-UHl0aG9u" aria-selected="false" class="sphinx-tabs-tab code-tab group-tab" id="tab-7-UHl0aG9u" name="UHl0aG9u" role="tab" tabindex="-1">Python</button></div><div aria-labelledby="tab-7-U2hlbGw=" class="sphinx-tabs-panel code-tab group-tab" id="panel-7-U2hlbGw=" name="U2hlbGw=" role="tabpanel" tabindex="0"><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>inq<span class="w"> </span>results<span class="w"> </span>ground<span class="w"> </span>state
</pre></div>
</div>
</div><div aria-labelledby="tab-7-UHl0aG9u" class="sphinx-tabs-panel code-tab group-tab" hidden="true" id="panel-7-UHl0aG9u" name="UHl0aG9u" role="tabpanel" tabindex="0"><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pinq</span><span class="o">.</span><span class="n">results</span><span class="o">.</span><span class="n">ground_state</span><span class="o">.</span><span class="n">status</span><span class="p">()</span>
</pre></div>
</div>
</div></div>
<p>It should print something like this:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="n">Ground</span><span class="o">-</span><span class="n">state</span><span class="w"> </span><span class="n">results</span><span class="o">:</span>
<span class="w"> </span><span class="n">iterations</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="mi">54</span>
<span class="w"> </span><span class="n">dipole</span><span class="w"> </span><span class="p">[</span><span class="n">a</span><span class="p">.</span><span class="n">u</span><span class="p">.]</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w">   </span><span class="mi">0</span><span class="w">       </span><span class="mi">0</span>
<span class="w"> </span><span class="n">magnetization</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w">   </span><span class="mi">0</span><span class="w">       </span><span class="mi">0</span>
<span class="w"> </span><span class="n">stress</span><span class="w"> </span><span class="p">[</span><span class="n">a</span><span class="p">.</span><span class="n">u</span><span class="p">.]</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="mf">0.00151421</span><span class="w">  </span><span class="mf">6.18129e-09</span><span class="w">     </span><span class="mf">-1.35831e-07</span>
<span class="w">                </span><span class="o">=</span><span class="w"> </span><span class="mf">6.18129e-09</span><span class="w"> </span><span class="mf">0.00151421</span><span class="w">      </span><span class="mf">-6.06216e-08</span>
<span class="w">                </span><span class="o">=</span><span class="w"> </span><span class="mf">-1.35831e-07</span><span class="w">        </span><span class="mf">-6.06216e-08</span><span class="w">    </span><span class="mf">-0.000340571</span>
<span class="w"> </span><span class="n">pressure</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="mf">-0.000895947</span><span class="w"> </span><span class="n">Ha</span><span class="o">/</span><span class="n">b</span><span class="o">^</span><span class="mi">3</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mf">-26.3597</span><span class="w"> </span><span class="n">GPa</span>
<span class="w"> </span><span class="n">total</span><span class="w"> </span><span class="n">energy</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="mf">-20.70537255</span><span class="w"> </span><span class="n">Ha</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mf">-563.42188978</span><span class="w"> </span><span class="n">eV</span>
</pre></div>
</div>
<p>We can also use this command to query specific values, this is particularly useful if we want to use scripts to post process the results. For example, to get the total energy we can use the following command</p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-8-U2hlbGw=" aria-selected="true" class="sphinx-tabs-tab code-tab group-tab" id="tab-8-U2hlbGw=" name="U2hlbGw=" role="tab" tabindex="0">Shell</button><button aria-controls="panel-8-UHl0aG9u" aria-selected="false" class="sphinx-tabs-tab code-tab group-tab" id="tab-8-UHl0aG9u" name="UHl0aG9u" role="tab" tabindex="-1">Python</button></div><div aria-labelledby="tab-8-U2hlbGw=" class="sphinx-tabs-panel code-tab group-tab" id="panel-8-U2hlbGw=" name="U2hlbGw=" role="tabpanel" tabindex="0"><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>inq<span class="w"> </span>results<span class="w"> </span>ground<span class="w"> </span>state<span class="w"> </span>energy<span class="w"> </span>total
</pre></div>
</div>
</div><div aria-labelledby="tab-8-UHl0aG9u" class="sphinx-tabs-panel code-tab group-tab" hidden="true" id="panel-8-UHl0aG9u" name="UHl0aG9u" role="tabpanel" tabindex="0"><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pinq</span><span class="o">.</span><span class="n">results</span><span class="o">.</span><span class="n">ground_state</span><span class="o">.</span><span class="n">energy</span><span class="o">.</span><span class="n">total</span><span class="p">()</span>
</pre></div>
</div>
</div></div>
<p>These function print/return a single value that can be captured to use it in scripting. In bash to capture the value you can use backticks to assign it to a variable. In python this is straightforward as the function returns a floating point value that you can directly assign to a variable.</p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-9-U2hlbGw=" aria-selected="true" class="sphinx-tabs-tab code-tab group-tab" id="tab-9-U2hlbGw=" name="U2hlbGw=" role="tab" tabindex="0">Shell</button><button aria-controls="panel-9-UHl0aG9u" aria-selected="false" class="sphinx-tabs-tab code-tab group-tab" id="tab-9-UHl0aG9u" name="UHl0aG9u" role="tab" tabindex="-1">Python</button></div><div aria-labelledby="tab-9-U2hlbGw=" class="sphinx-tabs-panel code-tab group-tab" id="panel-9-U2hlbGw=" name="U2hlbGw=" role="tabpanel" tabindex="0"><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">energy</span><span class="o">=</span><span class="sb">`</span>inq<span class="w"> </span>results<span class="w"> </span>ground<span class="w"> </span>state<span class="w"> </span>energy<span class="w"> </span>total<span class="sb">`</span>
</pre></div>
</div>
</div><div aria-labelledby="tab-9-UHl0aG9u" class="sphinx-tabs-panel code-tab group-tab" hidden="true" id="panel-9-UHl0aG9u" name="UHl0aG9u" role="tabpanel" tabindex="0"><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">energy</span> <span class="o">=</span> <span class="n">pinq</span><span class="o">.</span><span class="n">results</span><span class="o">.</span><span class="n">ground_state</span><span class="o">.</span><span class="n">energy</span><span class="o">.</span><span class="n">total</span><span class="p">()</span>
</pre></div>
</div>
</div></div>
<p>You can also query the forces with the command <cite>results ground state forces</cite>.</p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-10-U2hlbGw=" aria-selected="true" class="sphinx-tabs-tab code-tab group-tab" id="tab-10-U2hlbGw=" name="U2hlbGw=" role="tab" tabindex="0">Shell</button><button aria-controls="panel-10-UHl0aG9u" aria-selected="false" class="sphinx-tabs-tab code-tab group-tab" id="tab-10-UHl0aG9u" name="UHl0aG9u" role="tab" tabindex="-1">Python</button></div><div aria-labelledby="tab-10-U2hlbGw=" class="sphinx-tabs-panel code-tab group-tab" id="panel-10-U2hlbGw=" name="U2hlbGw=" role="tabpanel" tabindex="0"><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>inq<span class="w"> </span>results<span class="w"> </span>ground<span class="w"> </span>state<span class="w"> </span>forces
</pre></div>
</div>
</div><div aria-labelledby="tab-10-UHl0aG9u" class="sphinx-tabs-panel code-tab group-tab" hidden="true" id="panel-10-UHl0aG9u" name="UHl0aG9u" role="tabpanel" tabindex="0"><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pinq</span><span class="o">.</span><span class="n">results</span><span class="o">.</span><span class="n">ground_state</span><span class="o">.</span><span class="n">forces</span><span class="p">()</span>
</pre></div>
</div>
</div></div>
<p>This variable will print/return the forces for all atoms and all directions.
In the shell if you want to query a specific value, you can add more arguments to the command to specify which one you want.
The first option specifies the index of the atom you want the force for (starting for 0) and the second one the component of the forces you want (x, y, or z).
In python the forces are returned in an array, so you can just access the element you want.
For example, if you want the z component of the force for atom 0 you can use:</p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-11-U2hlbGw=" aria-selected="true" class="sphinx-tabs-tab code-tab group-tab" id="tab-11-U2hlbGw=" name="U2hlbGw=" role="tab" tabindex="0">Shell</button><button aria-controls="panel-11-UHl0aG9u" aria-selected="false" class="sphinx-tabs-tab code-tab group-tab" id="tab-11-UHl0aG9u" name="UHl0aG9u" role="tab" tabindex="-1">Python</button></div><div aria-labelledby="tab-11-U2hlbGw=" class="sphinx-tabs-panel code-tab group-tab" id="panel-11-U2hlbGw=" name="U2hlbGw=" role="tabpanel" tabindex="0"><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>inq<span class="w"> </span>results<span class="w"> </span>ground<span class="w"> </span>state<span class="w"> </span>forces<span class="w"> </span><span class="m">0</span><span class="w"> </span>z
</pre></div>
</div>
</div><div aria-labelledby="tab-11-UHl0aG9u" class="sphinx-tabs-panel code-tab group-tab" hidden="true" id="panel-11-UHl0aG9u" name="UHl0aG9u" role="tabpanel" tabindex="0"><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pinq</span><span class="o">.</span><span class="n">results</span><span class="o">.</span><span class="n">ground_state</span><span class="o">.</span><span class="n">forces</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>
</pre></div>
</div>
</div></div>
<p>This should give you a value around 0.2972.</p>
<p>Based on the results of the simulation would you consider the interatomic distance we used, 1.3 angstrom, corresponds to stable configuration?</p>
</section>
<section id="changing-the-ion-positions">
<h3><span class="section-number">5.1.5. </span>Changing the ion positions<a class="headerlink" href="#changing-the-ion-positions" title="Permalink to this heading"></a></h3>
<p>As you probably figure out the atoms in our simulation are not at the minimum energy configuration since the force is rather large. The experimental value of the interatomic distance of the N2 molecule is 110 pm. So let’s use that value in our simulation.</p>
<p>INQ has several commands to handle atoms that include <cite>remove</cite> (to remove a single ions) and <cite>ions clear</cite> that removes all ions in the system. You can check how to use them using the documentation for ions that can be accessed from the same command interface.</p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-12-U2hlbGw=" aria-selected="true" class="sphinx-tabs-tab code-tab group-tab" id="tab-12-U2hlbGw=" name="U2hlbGw=" role="tab" tabindex="0">Shell</button><button aria-controls="panel-12-UHl0aG9u" aria-selected="false" class="sphinx-tabs-tab code-tab group-tab" id="tab-12-UHl0aG9u" name="UHl0aG9u" role="tab" tabindex="-1">Python</button></div><div aria-labelledby="tab-12-U2hlbGw=" class="sphinx-tabs-panel code-tab group-tab" id="panel-12-U2hlbGw=" name="U2hlbGw=" role="tabpanel" tabindex="0"><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>inq<span class="w"> </span><span class="nb">help</span><span class="w"> </span>ions
</pre></div>
</div>
</div><div aria-labelledby="tab-12-UHl0aG9u" class="sphinx-tabs-panel code-tab group-tab" hidden="true" id="panel-12-UHl0aG9u" name="UHl0aG9u" role="tabpanel" tabindex="0"><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">help</span><span class="p">(</span><span class="n">pinq</span><span class="o">.</span><span class="n">ions</span><span class="p">)</span>
</pre></div>
</div>
</div></div>
<p>In this case we are going to use the <cite>ions clear</cite> command to remove all ions and then insert them again in the new position (make sure you replace NNN by the experimental value in pm):</p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-13-U2hlbGw=" aria-selected="true" class="sphinx-tabs-tab code-tab group-tab" id="tab-13-U2hlbGw=" name="U2hlbGw=" role="tab" tabindex="0">Shell</button><button aria-controls="panel-13-UHl0aG9u" aria-selected="false" class="sphinx-tabs-tab code-tab group-tab" id="tab-13-UHl0aG9u" name="UHl0aG9u" role="tab" tabindex="-1">Python</button></div><div aria-labelledby="tab-13-U2hlbGw=" class="sphinx-tabs-panel code-tab group-tab" id="panel-13-U2hlbGw=" name="U2hlbGw=" role="tabpanel" tabindex="0"><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>inq<span class="w"> </span>ions<span class="w"> </span>clear
inq<span class="w"> </span>ions<span class="w"> </span>insert<span class="w"> </span>N<span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w">   </span>NNN/2<span class="w"> </span>pm
inq<span class="w"> </span>ions<span class="w"> </span>insert<span class="w"> </span>N<span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w">  </span>-NNN/2<span class="w"> </span>pm
</pre></div>
</div>
</div><div aria-labelledby="tab-13-UHl0aG9u" class="sphinx-tabs-panel code-tab group-tab" hidden="true" id="panel-13-UHl0aG9u" name="UHl0aG9u" role="tabpanel" tabindex="0"><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pinq</span><span class="o">.</span><span class="n">ions</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
<span class="n">pinq</span><span class="o">.</span><span class="n">ions</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="s2">&quot;N&quot;</span><span class="p">,</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span>  <span class="n">NNN</span><span class="o">/</span><span class="mi">2</span><span class="p">],</span> <span class="s2">&quot;pm&quot;</span><span class="p">)</span>
<span class="n">pinq</span><span class="o">.</span><span class="n">ions</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="s2">&quot;N&quot;</span><span class="p">,</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="o">-</span><span class="n">NNN</span><span class="o">/</span><span class="mi">2</span><span class="p">],</span> <span class="s2">&quot;pm&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div></div>
<p>After the command verify that you have two atoms in the correct position.
Now run inq again using the <cite>run ground state</cite> command.</p>
<p>What can you say about the results? Did the energy become smaller? Did the force become close to zero?</p>
</section>
<section id="scripting-the-potential-energy-surface-of-n2">
<h3><span class="section-number">5.1.6. </span>Scripting: the potential energy surface of N2<a class="headerlink" href="#scripting-the-potential-energy-surface-of-n2" title="Permalink to this heading"></a></h3>
<p>We are now going to explore the power of INQ interface by writing a script that iterates over the interatomic distance calculating the energy for each value.</p>
<p>This is the template of the script we are going to use:</p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-14-U2hlbGw=" aria-selected="true" class="sphinx-tabs-tab code-tab group-tab" id="tab-14-U2hlbGw=" name="U2hlbGw=" role="tab" tabindex="0">Shell</button><button aria-controls="panel-14-UHl0aG9u" aria-selected="false" class="sphinx-tabs-tab code-tab group-tab" id="tab-14-UHl0aG9u" name="UHl0aG9u" role="tab" tabindex="-1">Python</button></div><div aria-labelledby="tab-14-U2hlbGw=" class="sphinx-tabs-panel code-tab group-tab" id="panel-14-U2hlbGw=" name="U2hlbGw=" role="tabpanel" tabindex="0"><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">set</span><span class="w"> </span>-e<span class="w"> </span><span class="c1">#make the script fail if a command fails</span>

<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;#distance energy&quot;</span><span class="w"> </span>&gt;<span class="w"> </span>pes.dat

<span class="k">for</span><span class="w"> </span>dist<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="sb">`</span>seq<span class="w"> </span><span class="m">0</span>.8<span class="w"> </span><span class="m">0</span>.025<span class="w"> </span><span class="m">1</span>.301<span class="sb">`</span><span class="p">;</span><span class="w"> </span><span class="k">do</span>
<span class="w">  </span><span class="c1">#run the ground state for distance `$dist` here</span>
<span class="w">  </span><span class="nv">energy</span><span class="o">=</span><span class="m">0</span>.0
<span class="w">  </span><span class="nb">echo</span><span class="w"> </span><span class="nv">$dist</span><span class="w"> </span><span class="nv">$energy</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>pes.dat
<span class="k">done</span>
</pre></div>
</div>
</div><div aria-labelledby="tab-14-UHl0aG9u" class="sphinx-tabs-panel code-tab group-tab" hidden="true" id="panel-14-UHl0aG9u" name="UHl0aG9u" role="tabpanel" tabindex="0"><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pinq</span>
<span class="kn">import</span> <span class="nn">numpy</span>

<span class="n">pes</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">dist</span> <span class="ow">in</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">0.8</span><span class="p">,</span> <span class="mf">1.301</span><span class="p">,</span> <span class="mf">0.025</span><span class="p">):</span>
  <span class="c1">#run the ground state for distance `dist` here</span>
  <span class="n">energy</span> <span class="o">=</span> <span class="mf">0.0</span>
  <span class="n">pes</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">dist</span><span class="p">,</span> <span class="n">energy</span><span class="p">])</span>
</pre></div>
</div>
</div></div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>For bash save the script on a file called <cite>pes.sh</cite>, to run it just type <cite>bash pes.sh</cite>. For Python name the file <cite>pes.py</cite> and run it with <cite>python3 pes.py</cite>.</p>
</div>
<p>This scripts iterates over the distance from 0.8 to 1.3 with steps of 0.025 size. For each distance it saves the value of the distance and the energy (that we here just set to zero) For bash the distance and energy values are saved in a file called <cite>pes.dat</cite>. You can easily plot this file using a program like gnuplot. For Python we store the results in an array. You can use matplotlib to plot them (you might need to transpose the array using <cite>numpy.transpose(pes)</cite>).</p>
<p>Now it is your job to modify this script to do the actual calculations. Inside the loop iteration you need to set the interatomic distance and run INQ to calculate the new energy. You also need to obtain the total energy value for INQ and store it in the <cite>energy</cite> variable, we show you how to do this previously in this tutorial. <strong>Note how much simpler it is to do get the energy compared to other codes where you would need to parse some text file.</strong></p>
<p>There are two approaches you can take to write your script:</p>
<ul class="simple">
<li><p>The first one is to rely on the calculation you already setup in the current folder, so you only need to change the coordinates. This makes a simpler script but it depends on the simulation already setup. It won’t run on a different directory.</p></li>
<li><p>The second approach is to run a standalone script by adding all the calculation setup (the cell, cutoff). This script is a bit more complex but can run independently of the previous simulation you set. If you decide to do it this way, don’t forget to use the <cite>clear</cite> command before hand to avoid issues.</p></li>
</ul>
<p>Once you have your script, execute it. Now you can plot the potential energy surface with your favorite plotting tool. It should look something like this (hopefully prettier):</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="mf">-20.2</span><span class="w"> </span><span class="o">+-------------------------------------------------------------------+</span>
<span class="w">      </span><span class="o">|</span><span class="w">             </span><span class="o">+</span><span class="w">            </span><span class="o">+</span><span class="w">             </span><span class="o">+</span><span class="w">            </span><span class="o">+</span><span class="w">             </span><span class="o">|</span>
<span class="w">      </span><span class="o">|</span><span class="w">                                                                   </span><span class="o">|</span>
<span class="mf">-20.3</span><span class="w"> </span><span class="o">|*+</span><span class="w">                                                               </span><span class="o">+-|</span>
<span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="o">*</span><span class="w">                                                                 </span><span class="o">|</span>
<span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="o">*</span><span class="w">                                                                 </span><span class="o">|</span>
<span class="w">      </span><span class="o">|</span><span class="w">  </span><span class="o">*</span><span class="w">                                                                </span><span class="o">|</span>
<span class="mf">-20.4</span><span class="w"> </span><span class="o">|-+</span><span class="w"> </span><span class="o">*</span><span class="w">                                                             </span><span class="o">+-|</span>
<span class="w">      </span><span class="o">|</span><span class="w">    </span><span class="o">**</span><span class="w">                                                             </span><span class="o">|</span>
<span class="w">      </span><span class="o">|</span><span class="w">      </span><span class="o">*</span><span class="w">                                                            </span><span class="o">|</span>
<span class="mf">-20.5</span><span class="w"> </span><span class="o">|-+</span><span class="w">     </span><span class="o">**</span><span class="w">                                                        </span><span class="o">+-|</span>
<span class="w">      </span><span class="o">|</span><span class="w">         </span><span class="o">*</span><span class="w">                                                         </span><span class="o">|</span>
<span class="w">      </span><span class="o">|</span><span class="w">          </span><span class="o">**</span><span class="w">                                                       </span><span class="o">|</span>
<span class="mf">-20.6</span><span class="w"> </span><span class="o">|-+</span><span class="w">          </span><span class="o">**</span><span class="w">                                                   </span><span class="o">+-|</span>
<span class="w">      </span><span class="o">|</span><span class="w">              </span><span class="o">**</span><span class="w">                                                   </span><span class="o">|</span>
<span class="w">      </span><span class="o">|</span><span class="w">                </span><span class="o">**</span><span class="w">                                                 </span><span class="o">|</span>
<span class="w">      </span><span class="o">|</span><span class="w">                  </span><span class="o">***</span><span class="w">                                              </span><span class="o">|</span>
<span class="mf">-20.7</span><span class="w"> </span><span class="o">|-+</span><span class="w">                   </span><span class="o">****</span><span class="w">                                     </span><span class="o">*****|</span>
<span class="w">      </span><span class="o">|</span><span class="w">                         </span><span class="o">*******</span><span class="w">                    </span><span class="o">**********</span><span class="w">     </span><span class="o">|</span>
<span class="w">      </span><span class="o">|</span><span class="w">             </span><span class="o">+</span><span class="w">            </span><span class="o">+</span><span class="w">     </span><span class="o">********************</span><span class="w"> </span><span class="o">+</span><span class="w">             </span><span class="o">|</span>
<span class="mf">-20.8</span><span class="w"> </span><span class="o">+-------------------------------------------------------------------+</span>
<span class="w">      </span><span class="mf">0.8</span><span class="w">           </span><span class="mf">0.9</span><span class="w">           </span><span class="mi">1</span><span class="w">            </span><span class="mf">1.1</span><span class="w">          </span><span class="mf">1.2</span><span class="w">           </span><span class="mf">1.3</span>
</pre></div>
</div>
<p>Now modify your script to also get the interatomic force and plot that value too. The result should look something like this:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="w">    </span><span class="mi">3</span><span class="w"> </span><span class="o">+--------------------------------------------------------------------+</span>
<span class="w">      </span><span class="o">|</span><span class="w">             </span><span class="o">+</span><span class="w">             </span><span class="o">+</span><span class="w">            </span><span class="o">+</span><span class="w">             </span><span class="o">+</span><span class="w">             </span><span class="o">|</span>
<span class="w">      </span><span class="o">|</span><span class="w">                                                                    </span><span class="o">|</span>
<span class="w">  </span><span class="mf">2.5</span><span class="w"> </span><span class="o">|*+</span><span class="w">                                                                </span><span class="o">+-|</span>
<span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="o">*</span><span class="w">                                                                  </span><span class="o">|</span>
<span class="w">      </span><span class="o">|</span><span class="w">  </span><span class="o">*</span><span class="w">                                                                 </span><span class="o">|</span>
<span class="w">    </span><span class="mi">2</span><span class="w"> </span><span class="o">|-+</span><span class="w"> </span><span class="o">**</span><span class="w">                                                             </span><span class="o">+-|</span>
<span class="w">      </span><span class="o">|</span><span class="w">     </span><span class="o">**</span><span class="w">                                                             </span><span class="o">|</span>
<span class="w">      </span><span class="o">|</span><span class="w">       </span><span class="o">**</span><span class="w">                                                           </span><span class="o">|</span>
<span class="w">  </span><span class="mf">1.5</span><span class="w"> </span><span class="o">|-+</span><span class="w">       </span><span class="o">**</span><span class="w">                                                       </span><span class="o">+-|</span>
<span class="w">      </span><span class="o">|</span><span class="w">           </span><span class="o">***</span><span class="w">                                                      </span><span class="o">|</span>
<span class="w">    </span><span class="mi">1</span><span class="w"> </span><span class="o">|-+</span><span class="w">            </span><span class="o">**</span><span class="w">                                                  </span><span class="o">+-|</span>
<span class="w">      </span><span class="o">|</span><span class="w">                </span><span class="o">**</span><span class="w">                                                  </span><span class="o">|</span>
<span class="w">      </span><span class="o">|</span><span class="w">                  </span><span class="o">****</span><span class="w">                                              </span><span class="o">|</span>
<span class="w">  </span><span class="mf">0.5</span><span class="w"> </span><span class="o">|-+</span><span class="w">                    </span><span class="o">***</span><span class="w">                                         </span><span class="o">+-|</span>
<span class="w">      </span><span class="o">|</span><span class="w">                         </span><span class="o">****</span><span class="w">                                       </span><span class="o">|</span>
<span class="w">      </span><span class="o">|</span><span class="w">                             </span><span class="o">*******</span><span class="w">                                </span><span class="o">|</span>
<span class="w">    </span><span class="mi">0</span><span class="w"> </span><span class="o">|-+</span><span class="w">                                  </span><span class="o">******</span><span class="w">                        </span><span class="o">+-|</span>
<span class="w">      </span><span class="o">|</span><span class="w">                                          </span><span class="o">******************</span><span class="w">        </span><span class="o">|</span>
<span class="w">      </span><span class="o">|</span><span class="w">             </span><span class="o">+</span><span class="w">             </span><span class="o">+</span><span class="w">            </span><span class="o">+</span><span class="w">             </span><span class="o">+</span><span class="w">     </span><span class="o">********|</span>
<span class="mf">-0.5</span><span class="w"> </span><span class="o">+--------------------------------------------------------------------+</span>
<span class="w">    </span><span class="mf">0.8</span><span class="w">           </span><span class="mf">0.9</span><span class="w">            </span><span class="mi">1</span><span class="w">           </span><span class="mf">1.1</span><span class="w">           </span><span class="mf">1.2</span><span class="w">           </span><span class="mf">1.3</span>
</pre></div>
</div>
</section>
</section>
<section id="benzene-optical-absorption-spectrum">
<h2><span class="section-number">5.2. </span>Benzene optical absorption spectrum<a class="headerlink" href="#benzene-optical-absorption-spectrum" title="Permalink to this heading"></a></h2>
<p>Now we are going to move to the domain of time-dependent density functional theory (TDDFT) to calculate excited states properties.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This tutorial builds upon what you learned before, so make sure to check the previous tutorial if you haven’t done it.</p>
</div>
<section id="simulation-parameters">
<h3><span class="section-number">5.2.1. </span>Simulation parameters<a class="headerlink" href="#simulation-parameters" title="Permalink to this heading"></a></h3>
<p>We will start by a simple case, the optical absorption of a molecule, in this case benzene. The first thing to do is to create a new folder for our simulation (as we did before). Remember that in INQ you need a separate folder for each simulation.</p>
<p>This time, instead of giving the ion positions one by one we will load it from an XYZ file. Create that file, naming it <cite>benzene.xyz</cite> with the following content:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="mi">12</span>
<span class="n">Geometry</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">benzene</span><span class="w"> </span><span class="p">(</span><span class="n">in</span><span class="w"> </span><span class="n">Angstrom</span><span class="p">)</span>
<span class="n">C</span><span class="w">  </span><span class="mf">0.000</span><span class="w">  </span><span class="mf">1.396</span><span class="w">  </span><span class="mf">0.000</span>
<span class="n">C</span><span class="w">  </span><span class="mf">1.209</span><span class="w">  </span><span class="mf">0.698</span><span class="w">  </span><span class="mf">0.000</span>
<span class="n">C</span><span class="w">  </span><span class="mf">1.209</span><span class="w"> </span><span class="mf">-0.698</span><span class="w">  </span><span class="mf">0.000</span>
<span class="n">C</span><span class="w">  </span><span class="mf">0.000</span><span class="w"> </span><span class="mf">-1.396</span><span class="w">  </span><span class="mf">0.000</span>
<span class="n">C</span><span class="w"> </span><span class="mf">-1.209</span><span class="w"> </span><span class="mf">-0.698</span><span class="w">  </span><span class="mf">0.000</span>
<span class="n">C</span><span class="w"> </span><span class="mf">-1.209</span><span class="w">  </span><span class="mf">0.698</span><span class="w">  </span><span class="mf">0.000</span>
<span class="n">H</span><span class="w">  </span><span class="mf">0.000</span><span class="w">  </span><span class="mf">2.479</span><span class="w">  </span><span class="mf">0.000</span>
<span class="n">H</span><span class="w">  </span><span class="mf">2.147</span><span class="w">  </span><span class="mf">1.240</span><span class="w">  </span><span class="mf">0.000</span>
<span class="n">H</span><span class="w">  </span><span class="mf">2.147</span><span class="w"> </span><span class="mf">-1.240</span><span class="w">  </span><span class="mf">0.000</span>
<span class="n">H</span><span class="w">  </span><span class="mf">0.000</span><span class="w"> </span><span class="mf">-2.479</span><span class="w">  </span><span class="mf">0.000</span>
<span class="n">H</span><span class="w"> </span><span class="mf">-2.147</span><span class="w"> </span><span class="mf">-1.240</span><span class="w">  </span><span class="mf">0.000</span>
<span class="n">H</span><span class="w"> </span><span class="mf">-2.147</span><span class="w">  </span><span class="mf">1.240</span><span class="w">  </span><span class="mf">0.000</span>
</pre></div>
</div>
<p>To load the XYZ into INQ we will use the following command.</p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-15-U2hlbGw=" aria-selected="true" class="sphinx-tabs-tab code-tab group-tab" id="tab-15-U2hlbGw=" name="U2hlbGw=" role="tab" tabindex="0">Shell</button><button aria-controls="panel-15-UHl0aG9u" aria-selected="false" class="sphinx-tabs-tab code-tab group-tab" id="tab-15-UHl0aG9u" name="UHl0aG9u" role="tab" tabindex="-1">Python</button></div><div aria-labelledby="tab-15-U2hlbGw=" class="sphinx-tabs-panel code-tab group-tab" id="panel-15-U2hlbGw=" name="U2hlbGw=" role="tabpanel" tabindex="0"><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>inq<span class="w"> </span>ions<span class="w"> </span>file<span class="w"> </span>benzene.xyz<span class="w"> </span>radius<span class="w"> </span><span class="m">10</span><span class="w"> </span>bohr
</pre></div>
</div>
</div><div aria-labelledby="tab-15-UHl0aG9u" class="sphinx-tabs-panel code-tab group-tab" hidden="true" id="panel-15-UHl0aG9u" name="UHl0aG9u" role="tabpanel" tabindex="0"><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pinq</span><span class="o">.</span><span class="n">ions</span><span class="o">.</span><span class="n">file</span><span class="p">(</span><span class="s2">&quot;benzene.xyz&quot;</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">,</span> <span class="s2">&quot;bohr&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div></div>
<p>This simply tells inq to load all the atoms from an XYZ file. Since a standard XYZ does not contain information about the cell, we need to give this information as an extra argument. We could give INQ a full cell definition as before, but for convenience INQ can also take a distance argument when importing an XYZ. This automatically creates a finite orthorhombic cell where no atom is closer than this distance to the cell boundaries. This is practical for molecular simulations where you need to converge the size of the cell.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>INQ can also read the cell and atomic coordinate information from <cite>CIF</cite> and <cite>VASP POSCAR</cite> files.</p>
</div>
<p>Now we need to setup the parameters for the electrons. This time, however, instead of specifying the energy cutoff we will use the real-space grid spacing as</p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-16-U2hlbGw=" aria-selected="true" class="sphinx-tabs-tab code-tab group-tab" id="tab-16-U2hlbGw=" name="U2hlbGw=" role="tab" tabindex="0">Shell</button><button aria-controls="panel-16-UHl0aG9u" aria-selected="false" class="sphinx-tabs-tab code-tab group-tab" id="tab-16-UHl0aG9u" name="UHl0aG9u" role="tab" tabindex="-1">Python</button></div><div aria-labelledby="tab-16-U2hlbGw=" class="sphinx-tabs-panel code-tab group-tab" id="panel-16-U2hlbGw=" name="U2hlbGw=" role="tabpanel" tabindex="0"><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>inq<span class="w"> </span>electrons<span class="w"> </span>spacing<span class="w"> </span><span class="m">0</span>.43<span class="w"> </span>bohr
</pre></div>
</div>
</div><div aria-labelledby="tab-16-UHl0aG9u" class="sphinx-tabs-panel code-tab group-tab" hidden="true" id="panel-16-UHl0aG9u" name="UHl0aG9u" role="tabpanel" tabindex="0"><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pinq</span><span class="o">.</span><span class="n">electrons</span><span class="o">.</span><span class="n">spacing</span><span class="p">(</span><span class="mf">0.43</span><span class="p">,</span> <span class="s2">&quot;bohr&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div></div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Using the spacing or the cutoff are equivalent and produce the same result. It’s just a matter of convenience.</p>
</div>
</section>
<section id="ground-state-calculation">
<h3><span class="section-number">5.2.2. </span>Ground state calculation<a class="headerlink" href="#ground-state-calculation" title="Permalink to this heading"></a></h3>
<p>The first step in a real-time calculation is to calculate the ground state, that will set initial condition for our real-time simulation. So calculate the ground state with the <cite>run ground state</cite> command.</p>
</section>
<section id="first-time-propagation-finding-the-optimal-time-step">
<h3><span class="section-number">5.2.3. </span>First time propagation, finding the optimal time-step<a class="headerlink" href="#first-time-propagation-finding-the-optimal-time-step" title="Permalink to this heading"></a></h3>
<p>Now that we have a ground state we can do a real-time calculation. For this we need to set a few options. The first one is the time-step, this is a crucial quantity in a real-time propagation. If the time step is too large the simulation is unstable, if it is too small the calculation would be slower than necessarily. The time-step depends on the energy cutoff/spacing used for the simulation and possibly other parameters, so we should optimize it for each case. In INQ you set the time-step with the following command:</p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-17-U2hlbGw=" aria-selected="true" class="sphinx-tabs-tab code-tab group-tab" id="tab-17-U2hlbGw=" name="U2hlbGw=" role="tab" tabindex="0">Shell</button><button aria-controls="panel-17-UHl0aG9u" aria-selected="false" class="sphinx-tabs-tab code-tab group-tab" id="tab-17-UHl0aG9u" name="UHl0aG9u" role="tab" tabindex="-1">Python</button></div><div aria-labelledby="tab-17-U2hlbGw=" class="sphinx-tabs-panel code-tab group-tab" id="panel-17-U2hlbGw=" name="U2hlbGw=" role="tabpanel" tabindex="0"><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>inq<span class="w"> </span>real-time<span class="w"> </span>time-step<span class="w"> </span><span class="m">0</span>.08<span class="w"> </span>atu
</pre></div>
</div>
</div><div aria-labelledby="tab-17-UHl0aG9u" class="sphinx-tabs-panel code-tab group-tab" hidden="true" id="panel-17-UHl0aG9u" name="UHl0aG9u" role="tabpanel" tabindex="0"><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pinq</span><span class="o">.</span><span class="n">real_time</span><span class="o">.</span><span class="n">time_step</span><span class="p">(</span><span class="mf">0.08</span><span class="p">,</span> <span class="s2">&quot;atu&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div></div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>As with other quantities, INQ requires units for time magnitudes. In this case <cite>atu</cite> stands for <cite>atomictimeunits</cite>. You can also use <cite>attoseconds</cite> (<cite>as</cite>), <cite>femtoseconds</cite> (<cite>fs</cite>), and <cite>picoseconds</cite> (<cite>ps</cite>).</p>
</div>
<p>Our first task will be to find the optimal time-step for this case. After you add the propagation line above to your file, run INQ with:</p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-18-U2hlbGw=" aria-selected="true" class="sphinx-tabs-tab code-tab group-tab" id="tab-18-U2hlbGw=" name="U2hlbGw=" role="tab" tabindex="0">Shell</button><button aria-controls="panel-18-UHl0aG9u" aria-selected="false" class="sphinx-tabs-tab code-tab group-tab" id="tab-18-UHl0aG9u" name="UHl0aG9u" role="tab" tabindex="-1">Python</button></div><div aria-labelledby="tab-18-U2hlbGw=" class="sphinx-tabs-panel code-tab group-tab" id="panel-18-U2hlbGw=" name="U2hlbGw=" role="tabpanel" tabindex="0"><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>inq<span class="w"> </span>run<span class="w"> </span>real<span class="w"> </span><span class="nb">time</span>
</pre></div>
</div>
</div><div aria-labelledby="tab-18-UHl0aG9u" class="sphinx-tabs-panel code-tab group-tab" hidden="true" id="panel-18-UHl0aG9u" name="UHl0aG9u" role="tabpanel" tabindex="0"><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pinq</span><span class="o">.</span><span class="n">run</span><span class="o">.</span><span class="n">real_time</span><span class="p">()</span>
</pre></div>
</div>
</div></div>
<p>You should get an output like this:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">trace</span><span class="p">]</span><span class="w"> </span><span class="n">starting</span><span class="w"> </span><span class="n">real</span><span class="o">-</span><span class="n">time</span><span class="w"> </span><span class="n">propagation</span>
<span class="p">[</span><span class="n">info</span><span class="p">]</span><span class="w"> </span><span class="n">step</span><span class="w">         </span><span class="mi">0</span><span class="w"> </span><span class="o">:</span><span class="w">  </span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w">      </span><span class="mf">0.000</span><span class="w">  </span><span class="n">e</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">-39.547750090759</span>
<span class="p">[</span><span class="n">info</span><span class="p">]</span><span class="w"> </span><span class="n">step</span><span class="w">         </span><span class="mi">1</span><span class="w"> </span><span class="o">:</span><span class="w">  </span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w">      </span><span class="mf">0.080</span><span class="w">  </span><span class="n">e</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">-39.547744740076</span><span class="w">  </span><span class="n">wtime</span><span class="w"> </span><span class="o">=</span><span class="w">     </span><span class="mf">0.444</span>
<span class="p">[</span><span class="n">info</span><span class="p">]</span><span class="w"> </span><span class="n">step</span><span class="w">         </span><span class="mi">2</span><span class="w"> </span><span class="o">:</span><span class="w">  </span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w">      </span><span class="mf">0.160</span><span class="w">  </span><span class="n">e</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">-39.547742901329</span><span class="w">  </span><span class="n">wtime</span><span class="w"> </span><span class="o">=</span><span class="w">     </span><span class="mf">0.416</span>
<span class="p">[</span><span class="n">info</span><span class="p">]</span><span class="w"> </span><span class="n">step</span><span class="w">         </span><span class="mi">3</span><span class="w"> </span><span class="o">:</span><span class="w">  </span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w">      </span><span class="mf">0.240</span><span class="w">  </span><span class="n">e</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">-39.547736053030</span><span class="w">  </span><span class="n">wtime</span><span class="w"> </span><span class="o">=</span><span class="w">     </span><span class="mf">0.427</span>
<span class="p">[</span><span class="n">info</span><span class="p">]</span><span class="w"> </span><span class="n">step</span><span class="w">         </span><span class="mi">4</span><span class="w"> </span><span class="o">:</span><span class="w">  </span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w">      </span><span class="mf">0.320</span><span class="w">  </span><span class="n">e</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">-39.547722024915</span><span class="w">  </span><span class="n">wtime</span><span class="w"> </span><span class="o">=</span><span class="w">     </span><span class="mf">0.414</span>
<span class="p">[</span><span class="n">info</span><span class="p">]</span><span class="w"> </span><span class="n">step</span><span class="w">         </span><span class="mi">5</span><span class="w"> </span><span class="o">:</span><span class="w">  </span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w">      </span><span class="mf">0.400</span><span class="w">  </span><span class="n">e</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">-39.547611402019</span><span class="w">  </span><span class="n">wtime</span><span class="w"> </span><span class="o">=</span><span class="w">     </span><span class="mf">0.417</span>
<span class="p">[</span><span class="n">info</span><span class="p">]</span><span class="w"> </span><span class="n">step</span><span class="w">         </span><span class="mi">6</span><span class="w"> </span><span class="o">:</span><span class="w">  </span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w">      </span><span class="mf">0.480</span><span class="w">  </span><span class="n">e</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">-39.546318301288</span><span class="w">  </span><span class="n">wtime</span><span class="w"> </span><span class="o">=</span><span class="w">     </span><span class="mf">0.438</span>
<span class="p">[</span><span class="n">info</span><span class="p">]</span><span class="w"> </span><span class="n">step</span><span class="w">         </span><span class="mi">7</span><span class="w"> </span><span class="o">:</span><span class="w">  </span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w">      </span><span class="mf">0.560</span><span class="w">  </span><span class="n">e</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">-39.529646335901</span><span class="w">  </span><span class="n">wtime</span><span class="w"> </span><span class="o">=</span><span class="w">     </span><span class="mf">0.442</span>
<span class="p">[</span><span class="n">info</span><span class="p">]</span><span class="w"> </span><span class="n">step</span><span class="w">         </span><span class="mi">8</span><span class="w"> </span><span class="o">:</span><span class="w">  </span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w">      </span><span class="mf">0.640</span><span class="w">  </span><span class="n">e</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">-39.302794826777</span><span class="w">  </span><span class="n">wtime</span><span class="w"> </span><span class="o">=</span><span class="w">     </span><span class="mf">0.418</span>
<span class="p">[</span><span class="n">info</span><span class="p">]</span><span class="w"> </span><span class="n">step</span><span class="w">         </span><span class="mi">9</span><span class="w"> </span><span class="o">:</span><span class="w">  </span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w">      </span><span class="mf">0.720</span><span class="w">  </span><span class="n">e</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">-36.145930399491</span><span class="w">  </span><span class="n">wtime</span><span class="w"> </span><span class="o">=</span><span class="w">     </span><span class="mf">0.419</span>
<span class="p">[</span><span class="n">info</span><span class="p">]</span><span class="w"> </span><span class="n">step</span><span class="w">        </span><span class="mi">10</span><span class="w"> </span><span class="o">:</span><span class="w">  </span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w">      </span><span class="mf">0.800</span><span class="w">  </span><span class="n">e</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">5.739670746138</span><span class="w">  </span><span class="n">wtime</span><span class="w"> </span><span class="o">=</span><span class="w">     </span><span class="mf">0.412</span>
<span class="p">...</span>
</pre></div>
</div>
<p>We are interested in the energy values that start with <cite>e = …</cite>. Since our system does not have any (time-dependent) perturbation yet the energy should be conserved. But in this case we have deliberately chosen a too-large time step that will make the energy increase rapidly because the simulation is unstable. Let it run for some steps to convince yourself that is the case.</p>
<p>Now modify the time-step in your input and see what happens with the energy values. Repeat this until a few times you find the largest value of the time-step that give you a stable energy. Note that we are looking for stability rather than exact energy conservation, with a proper time-step the energy will oscillate around a value instead of exploding.</p>
</section>
<section id="adding-a-perturbation">
<h3><span class="section-number">5.2.4. </span>Adding a perturbation<a class="headerlink" href="#adding-a-perturbation" title="Permalink to this heading"></a></h3>
<p>Now that you have found the optimal step, let’s do some more physically interesting. Up to now our propagation doesn’t have any perturbation, so it stays in the ground-state just changing the phase of the orbitals. Let’s change that.</p>
<p>INQ defines the concept of a perturbation: an external change in the systems that affects the electrons. Note that a perturbation does not necessarily have to be small, real-time TDDFT can study the response of strongly-driven systems as well.</p>
<p>In this case we will use a kick, this is an electric field perturbation of the form <span class="math notranslate nohighlight">\(\vec{E}(r, t)=\vec{\kappa}\delta(t)\)</span>. The advantage of a kick is that it is flat in Fourier space, so it excites all frequencies equally, making it useful for linear response calculations. This is how we define a kick:</p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-19-U2hlbGw=" aria-selected="true" class="sphinx-tabs-tab code-tab group-tab" id="tab-19-U2hlbGw=" name="U2hlbGw=" role="tab" tabindex="0">Shell</button><button aria-controls="panel-19-UHl0aG9u" aria-selected="false" class="sphinx-tabs-tab code-tab group-tab" id="tab-19-UHl0aG9u" name="UHl0aG9u" role="tab" tabindex="-1">Python</button></div><div aria-labelledby="tab-19-U2hlbGw=" class="sphinx-tabs-panel code-tab group-tab" id="panel-19-U2hlbGw=" name="U2hlbGw=" role="tabpanel" tabindex="0"><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>inq<span class="w"> </span>perturbation<span class="w"> </span>kick<span class="w"> </span><span class="m">0</span>.01<span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span>
</pre></div>
</div>
</div><div aria-labelledby="tab-19-UHl0aG9u" class="sphinx-tabs-panel code-tab group-tab" hidden="true" id="panel-19-UHl0aG9u" name="UHl0aG9u" role="tabpanel" tabindex="0"><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pinq</span><span class="o">.</span><span class="n">perturbation</span><span class="o">.</span><span class="n">kick</span><span class="p">([</span><span class="mf">0.01</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
</div></div>
<p>The argument is the direction and intensity of the kick <span class="math notranslate nohighlight">\(\kappa\)</span>. Since we are interested in linear response we use a small amplitude to avoid non-linear effects to appear on our simulation (these effects depend at least on <span class="math notranslate nohighlight">\(\kappa^2\)</span>).</p>
</section>
<section id="defining-the-observables">
<h3><span class="section-number">5.2.5. </span>Defining the observables<a class="headerlink" href="#defining-the-observables" title="Permalink to this heading"></a></h3>
<p>To make our simulation useful we also need to obtain some data out of it. There are many possible observables in a simulation that we want to look at, however calculating them and storing them can be expensive so we only want to calculate what we really need. For this reason we need to tell INQ beforehand what observables we want.</p>
<p>For the calculation of the absorption spectrum of a molecule the quantity we are interested is the dipole. So we tell INQ:</p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-20-U2hlbGw=" aria-selected="true" class="sphinx-tabs-tab code-tab group-tab" id="tab-20-U2hlbGw=" name="U2hlbGw=" role="tab" tabindex="0">Shell</button><button aria-controls="panel-20-UHl0aG9u" aria-selected="false" class="sphinx-tabs-tab code-tab group-tab" id="tab-20-UHl0aG9u" name="UHl0aG9u" role="tab" tabindex="-1">Python</button></div><div aria-labelledby="tab-20-U2hlbGw=" class="sphinx-tabs-panel code-tab group-tab" id="panel-20-U2hlbGw=" name="U2hlbGw=" role="tabpanel" tabindex="0"><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>inq<span class="w"> </span>real-time<span class="w"> </span>observables<span class="w"> </span>dipole
</pre></div>
</div>
</div><div aria-labelledby="tab-20-UHl0aG9u" class="sphinx-tabs-panel code-tab group-tab" hidden="true" id="panel-20-UHl0aG9u" name="UHl0aG9u" role="tabpanel" tabindex="0"><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pinq</span><span class="o">.</span><span class="n">real_time</span><span class="o">.</span><span class="n">observables</span><span class="o">.</span><span class="n">dipole</span><span class="p">()</span>
</pre></div>
</div>
</div></div>
</section>
<section id="run-the-propagation">
<h3><span class="section-number">5.2.6. </span>Run the propagation<a class="headerlink" href="#run-the-propagation" title="Permalink to this heading"></a></h3>
<p>We are almost ready to run the simulation, the only part we are missing is top specify the length of the simulation. The longer the simulation is, the more well defined the absorption peaks will be, but at the same time the simulation will be more expensive. In practice, the time we need around <span class="math notranslate nohighlight">\(10\)</span> fs (<span class="math notranslate nohighlight">\(~400\)</span> atu) for a converged spectrum. In this tutorial we will use a shorter time of <span class="math notranslate nohighlight">\(5\)</span> fs to avoid waiting for too long. This is set with the command:</p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-21-U2hlbGw=" aria-selected="true" class="sphinx-tabs-tab code-tab group-tab" id="tab-21-U2hlbGw=" name="U2hlbGw=" role="tab" tabindex="0">Shell</button><button aria-controls="panel-21-UHl0aG9u" aria-selected="false" class="sphinx-tabs-tab code-tab group-tab" id="tab-21-UHl0aG9u" name="UHl0aG9u" role="tab" tabindex="-1">Python</button></div><div aria-labelledby="tab-21-U2hlbGw=" class="sphinx-tabs-panel code-tab group-tab" id="panel-21-U2hlbGw=" name="U2hlbGw=" role="tabpanel" tabindex="0"><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>inq<span class="w"> </span>real-time<span class="w"> </span>propagation-time<span class="w"> </span><span class="m">5</span><span class="w"> </span>fs
</pre></div>
</div>
</div><div aria-labelledby="tab-21-UHl0aG9u" class="sphinx-tabs-panel code-tab group-tab" hidden="true" id="panel-21-UHl0aG9u" name="UHl0aG9u" role="tabpanel" tabindex="0"><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pinq</span><span class="o">.</span><span class="n">real_time</span><span class="o">.</span><span class="n">propagation_time</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="s2">&quot;fs&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div></div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <cite>propagation time</cite> command sets the number of steps based on the currently set time-step. If you change the time-step, the total propagation time will change.</p>
</div>
<p>Now we can run the time-propagation with INQ. This is going to be longer than the runs we have done so far. If your machine has multiple CPUs or GPUs it is recommended that you run this in parallel. Depending on your system it could take around 10 minutes to an hour. Can estimate how long it will take to run in your machine? (INQ prints the time it take for each iteration as the <cite>wtime</cite> value.)</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Even if you are working in Python you can call the shell version of <cite>inq run</cite> as long as you are standing in the same folder.</p>
</div>
</section>
<section id="analyzing-the-results-and-obtaining-the-spectrum">
<h3><span class="section-number">5.2.7. </span>Analyzing the results and obtaining the spectrum<a class="headerlink" href="#analyzing-the-results-and-obtaining-the-spectrum" title="Permalink to this heading"></a></h3>
<p>Once the simulation is done we can analyze the results. The command</p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-22-U2hlbGw=" aria-selected="true" class="sphinx-tabs-tab code-tab group-tab" id="tab-22-U2hlbGw=" name="U2hlbGw=" role="tab" tabindex="0">Shell</button><button aria-controls="panel-22-UHl0aG9u" aria-selected="false" class="sphinx-tabs-tab code-tab group-tab" id="tab-22-UHl0aG9u" name="UHl0aG9u" role="tab" tabindex="-1">Python</button></div><div aria-labelledby="tab-22-U2hlbGw=" class="sphinx-tabs-panel code-tab group-tab" id="panel-22-U2hlbGw=" name="U2hlbGw=" role="tabpanel" tabindex="0"><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>inq<span class="w"> </span>result<span class="w"> </span>real-time<span class="w"> </span>dipole
</pre></div>
</div>
</div><div aria-labelledby="tab-22-UHl0aG9u" class="sphinx-tabs-panel code-tab group-tab" hidden="true" id="panel-22-UHl0aG9u" name="UHl0aG9u" role="tabpanel" tabindex="0"><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pinq</span><span class="o">.</span><span class="n">results</span><span class="o">.</span><span class="n">real_time</span><span class="o">.</span><span class="n">dipole</span><span class="p">()</span>
</pre></div>
</div>
</div></div>
<p>will give us the back the time-dependent dipole function.</p>
<p>The shell version will give us back the data to the terminal 4 columns: the time and the x, y, and z components of the dipole. You can directly plot it using gnuplot. First run <cite>gnuplot</cite> and then type following command:</p>
<div class="highlight-gnuplot notranslate"><div class="highlight"><pre><span></span><span class="k">plot</span><span class="w"> </span><span class="s">&quot;&lt;inq results real time dipole&quot;</span><span class="w"> </span><span class="nb">w</span><span class="w"> </span><span class="n">l</span>
</pre></div>
</div>
<p>In Python things are a bit different, the <cite>dipole</cite> function will return a Python array of 3D vectors with the dipole for each step. You can get an array with the time for each step using the following command:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">times</span> <span class="o">=</span> <span class="n">pinq</span><span class="o">.</span><span class="n">results</span><span class="o">.</span><span class="n">real_time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</pre></div>
</div>
<p>You should be able to pass this information to a plotting library.</p>
<p>Since we perturbed our system with an electric field, the normalized Fourier transform of the time-dependent dipole function is the polarizability. (To normalize it you have to divide by <span class="math notranslate nohighlight">\(\kappa\)</span>, the intensity of the kick.) In this particular case we will calculate <span class="math notranslate nohighlight">\(\alpha_{11}\)</span>, the <span class="math notranslate nohighlight">\(xx\)</span> component of the polarizabilty tensor, as we perturbed the system in the <span class="math notranslate nohighlight">\(x\)</span> direction and we are looking at the <span class="math notranslate nohighlight">\(x\)</span> component of the dipole. To calculate the full tensor we would need 3 different time-propagations with perturbations in each direction.</p>
<p>You could use a third party program to calculate the Fourier transform, however note you need to add a window function to dump the dipole for long times (this is equivalent to adding a broadening in Fourier space). Conveniently, INQ has functionality to do this calculation using the command <cite>inq spectrum</cite>. This is how we can use it from the shell:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>inq<span class="w"> </span>results<span class="w"> </span>real<span class="w"> </span><span class="nb">time</span><span class="w"> </span>dipole<span class="w"> </span>&gt;<span class="w"> </span>dipole.dat
inq<span class="w"> </span>spectrum<span class="w"> </span>file<span class="w"> </span>dipole.dat<span class="w"> </span>&gt;<span class="w"> </span>spectrum.dat
</pre></div>
</div>
<p>Unfortunately the python interface of this function is still under development so we recommend you to use the shell version for now.</p>
<p>The file <cite>spectrum.dat</cite> contains 7 columns, the first one is the frequency (in Hartree) and the next 5 are the real and imaginary parts of the Fourier transforms of the 3 dipole components. The experimentally relevant quantity is</p>
<div class="math notranslate nohighlight">
\[S(\omega) = \frac{2\omega}{\pi}\Im\left(\alpha(\omega)\right)\]</div>
<p>so it would be interesting to plot that. Remember that the response should be properly normalized by the intensity of the perturbation, the spectrum utility doesn’t do it. Also remember that we only have part of the full polarizability tensor.</p>
<p>The Thomas-Reiche-Kuhn <span class="math notranslate nohighlight">\(f\)</span>-sum rule for the number of electrons, states that</p>
<div class="math notranslate nohighlight">
\[N=\int \mathrm{d}\omega S(\omega)\ ,\]</div>
<p>where <span class="math notranslate nohighlight">\(N\)</span> is the number of (valence) electrons. This is a good check to validate your results. Can you write a small code to calculate it?</p>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="interface.html" class="btn btn-neutral float-left" title="4. Interface" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="tutorial_cpp.html" class="btn btn-neutral float-right" title="6. Tutorial (C++)" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2019-2025 Lawrence Livermore National Security, LLC., Xavier Andrade, Alfredo A. Correa.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(false);
      });
  </script> 

</body>
</html>
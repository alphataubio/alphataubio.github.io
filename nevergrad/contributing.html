

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Contributing to Nevergrad &mdash; nevergrad  documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=e59714d7" />

  
      <script src="_static/jquery.js?v=5d32c60e"></script>
      <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="_static/documentation_options.js?v=5929fcd5"></script>
      <script src="_static/doctools.js?v=9bcbadda"></script>
      <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Open Optimization Competition 2020" href="opencompetition2020.html" />
    <link rel="prev" title="Running algorithm benchmarks" href="benchmarking.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            nevergrad
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">CONTENTS</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="getting_started.html">Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="windows.html">Installation and configuration on Windows</a></li>
<li class="toctree-l1"><a class="reference internal" href="optimization.html">How to perform optimization</a></li>
<li class="toctree-l1"><a class="reference internal" href="parametrization.html">Parametrizing your optimization</a></li>
<li class="toctree-l1"><a class="reference internal" href="benchmarking.html">Running algorithm benchmarks</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Contributing to Nevergrad</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#general-considerations">General considerations</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#our-development-process">Our Development Process</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pull-requests">Pull Requests</a></li>
<li class="toctree-l3"><a class="reference internal" href="#contributor-license-agreement-cla">Contributor License Agreement (“CLA”)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#issues">Issues</a></li>
<li class="toctree-l3"><a class="reference internal" href="#coding-style">Coding Style</a></li>
<li class="toctree-l3"><a class="reference internal" href="#documentation">Documentation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#license">License</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#adding-an-algorithm">Adding an algorithm</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#where-to-add-the-algorithm">Where to add the algorithm?</a></li>
<li class="toctree-l3"><a class="reference internal" href="#how-to-implement-it">How to implement it?</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#base-class-features">Base class features</a></li>
<li class="toctree-l4"><a class="reference internal" href="#methods-and-attributes">Methods and attributes</a></li>
<li class="toctree-l4"><a class="reference internal" href="#seeding">Seeding</a></li>
<li class="toctree-l4"><a class="reference internal" href="#about-type-hints">About type hints</a></li>
<li class="toctree-l4"><a class="reference internal" href="#optimizer-families">Optimizer families</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#how-to-test-it">How to test it</a></li>
<li class="toctree-l3"><a class="reference internal" href="#how-to-benchmark-it">How to benchmark it</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#how-benchmarks-are-implemented">How benchmarks are implemented</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="opencompetition2020.html">Open Optimization Competition 2020</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API REFERENCE</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="ref_optimizer.html">Optimizer API</a></li>
<li class="toctree-l1"><a class="reference internal" href="ref_parametrization.html">Parametrization API</a></li>
<li class="toctree-l1"><a class="reference internal" href="ref_callbacks.html">Callbacks API</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">EXAMPLES</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="machinelearning.html">Nevergrad for machine learning</a></li>
<li class="toctree-l1"><a class="reference internal" href="r.html">Nevergrad for R</a></li>
<li class="toctree-l1"><a class="reference internal" href="benchmarks.html">Benchmarks</a></li>
<li class="toctree-l1"><a class="reference internal" href="pyomo.html">Working with Pyomo model</a></li>
<li class="toctree-l1"><a class="reference internal" href="examples/guiding/Guiding%20image%20generation%20with%20Nevergrad.html">Guiding image generation with Nevergrad</a></li>
<li class="toctree-l1"><a class="reference internal" href="examples/diversity/Diversity%20in%20image%20generation%20with%20Nevergrad.html">Diversity</a></li>
<li class="toctree-l1"><a class="reference internal" href="examples/lognormal/Lognormal%20mutations%20in%20Nevergrad.html">Lognormal mutations in Nevergrad</a></li>
<li class="toctree-l1"><a class="reference internal" href="examples/retrofitting/Retrofitting%20with%20Nevergrad.html">Retrofitting with Nevergrad</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">STATISTICS</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="statistics/Statistics.html">Benchmarks in Nevergrad</a></li>
<li class="toctree-l1"><a class="reference internal" href="statistics/AgStatistics.html">Benchmarks in Nevergrad (excluding wizards)</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">nevergrad</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Contributing to Nevergrad</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/contributing.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="contributing-to-nevergrad">
<h1>Contributing to Nevergrad<a class="headerlink" href="#contributing-to-nevergrad" title="Link to this heading"></a></h1>
<section id="general-considerations">
<h2>General considerations<a class="headerlink" href="#general-considerations" title="Link to this heading"></a></h2>
<p>We want to make contributing to this project as easy and transparent as possible.</p>
<p>Whether you want to contribute or not, don’t hesitate to join <a class="reference external" href="https://www.facebook.com/groups/nevergradusers/">Nevergrad users’ Facebook group</a></p>
<section id="our-development-process">
<h3>Our Development Process<a class="headerlink" href="#our-development-process" title="Link to this heading"></a></h3>
<p>To install <code class="code docutils literal notranslate"><span class="pre">nevergrad</span></code> in development mode (if you wish to contribute to it), clone the repository and run <code class="code docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">-e</span> <span class="pre">.[all]</span></code> from inside the repository folder,
or <code class="code docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">-e</span> <span class="pre">'.[all]'</span></code> if you use <code class="code docutils literal notranslate"><span class="pre">zsh</span></code>. If the install fails because of <code class="code docutils literal notranslate"><span class="pre">torch</span></code>, you can preinstall it with the instructions <a class="reference external" href="https://pytorch.org/get-started/locally/">on Pytorch website</a>
and rerun <code class="code docutils literal notranslate"><span class="pre">nevergrad</span></code>’s installation.</p>
<p>Most of the code is covered by unit tests. You can run them with:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pytest<span class="w"> </span>nevergrad<span class="w"> </span>--cov<span class="o">=</span>nevergrad
</pre></div>
</div>
<p>You can then run <code class="code docutils literal notranslate"><span class="pre">mypy</span></code> on <code class="code docutils literal notranslate"><span class="pre">nevergrad</span></code> with:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mypy<span class="w"> </span>--implicit-reexport<span class="w"> </span>nevergrad
</pre></div>
</div>
<p>If you are not familiar with type checking, we do not want it to be an annoyance and you can can ignore errors by adding <code class="code docutils literal notranslate"><span class="pre">#</span> <span class="pre">type:</span> <span class="pre">ignore</span></code> at the end of lines flagged as incorrect.
If we consider it useful to have correct typing, we will update the code after your pull request is merged.
If you are however familiar with type hints, you can check with the strict mode: <code class="code docutils literal notranslate"><span class="pre">mypy</span> <span class="pre">--implicit-reexport</span> <span class="pre">--strict</span> <span class="pre">nevergrad</span></code>, but at any given moment all the code is not guaranteed to pass the test (we try to work on it regularly, see #409).</p>
<p>Unit tests and type checks (in non-strict mode) will be automatically run every time a pull request is submitted/updated.</p>
<p>Finally, we use pre-commit hooks to make sure the code follows the same coding style. We currently use  <cite>black</cite> and <code class="code docutils literal notranslate"><span class="pre">pylint</span></code>. To install them, just run <code class="code docutils literal notranslate"><span class="pre">pre-commit</span> <span class="pre">install</span></code> once, and they will be activated for all your commits on this repository.</p>
<p><code class="code docutils literal notranslate"><span class="pre">black</span></code> compliance is automatically checked on all PRs. If you do not use precommit hooks, you
can install <code class="code docutils literal notranslate"><span class="pre">black</span></code> with <code class="code docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">black</span></code> make your code compliant by running:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>black<span class="w"> </span>nevergrad
</pre></div>
</div>
</section>
<section id="pull-requests">
<h3>Pull Requests<a class="headerlink" href="#pull-requests" title="Link to this heading"></a></h3>
<p>We actively welcome your pull requests.</p>
<ol class="arabic simple">
<li><p>Fork the repo and create your branch from <code class="code docutils literal notranslate"><span class="pre">main</span></code>.</p></li>
<li><p>If you’ve added code that should be tested, add tests.</p></li>
<li><p>If you’ve changed APIs, update the documentation.</p></li>
<li><p>Ensure the test suite passes.</p></li>
<li><p>Make sure your code lints.</p></li>
<li><p>If you haven’t already, complete the Contributor License Agreement (“CLA”).</p></li>
</ol>
</section>
<section id="contributor-license-agreement-cla">
<h3>Contributor License Agreement (“CLA”)<a class="headerlink" href="#contributor-license-agreement-cla" title="Link to this heading"></a></h3>
<p>In order to accept your pull request, we need you to submit a CLA. You only need
to do this once to work on any of Facebook’s open source projects.</p>
<p>Complete your CLA here: &lt;<a class="reference external" href="https://code.facebook.com/cla">https://code.facebook.com/cla</a>&gt;</p>
</section>
<section id="issues">
<h3>Issues<a class="headerlink" href="#issues" title="Link to this heading"></a></h3>
<p>We use GitHub issues to track public bugs. Please ensure your description is
clear and has sufficient instructions to be able to reproduce the issue.</p>
<p>Facebook has a <a class="reference external" href="https://www.facebook.com/whitehat/">bounty program</a> for the safe
disclosure of security bugs. In those cases, please go through the process
outlined on that page and do not file a public issue.</p>
</section>
<section id="coding-style">
<h3>Coding Style<a class="headerlink" href="#coding-style" title="Link to this heading"></a></h3>
<p>We use pep8, but allow lines to be as long as 140 characters.
Please use the pre-commit hooks to ensure correctness (see section “Our Development Process”).</p>
</section>
<section id="documentation">
<h3>Documentation<a class="headerlink" href="#documentation" title="Link to this heading"></a></h3>
<p>Documentation can be build with <code class="code docutils literal notranslate"><span class="pre">make</span> <span class="pre">html</span></code> from the <code class="code docutils literal notranslate"><span class="pre">docs</span></code> folder.</p>
</section>
<section id="license">
<h3>License<a class="headerlink" href="#license" title="Link to this heading"></a></h3>
<p>By contributing to <code class="code docutils literal notranslate"><span class="pre">nevergrad</span></code>, you agree that your contributions will be licensed
under the LICENSE file in the root directory of this source tree.</p>
</section>
</section>
<section id="adding-an-algorithm">
<h2>Adding an algorithm<a class="headerlink" href="#adding-an-algorithm" title="Link to this heading"></a></h2>
<p>The following guidelines are for people who want to add an algorithm to <code class="code docutils literal notranslate"><span class="pre">nevergrad</span></code>. They may be already outdated, feel free to update them if you find them unclear or think they should evolve.</p>
<section id="where-to-add-the-algorithm">
<h3>Where to add the algorithm?<a class="headerlink" href="#where-to-add-the-algorithm" title="Link to this heading"></a></h3>
<p>All optimizers are implemented in the <code class="code docutils literal notranslate"><span class="pre">ng.optimization</span></code> subpackage, and all optimizer classes are available either in the <code class="code docutils literal notranslate"><span class="pre">ng.optimization.optimizerlib</span></code> module (which is aliased to <code class="code docutils literal notranslate"><span class="pre">ng.optimizers</span></code>, or through the optimizer registry: <code class="code docutils literal notranslate"><span class="pre">ng.optimizers.registry</span></code>.</p>
<p>Implementations are however spread into several files:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://github.com/facebookresearch/nevergrad/blob/main/nevergrad/optimization/optimizerlib.py">optimizerlib.py</a>: this is the default file, where most algorithms are implemented. It also imports optimizers from all other files.</p></li>
<li><p><a class="reference external" href="https://github.com/facebookresearch/nevergrad/blob/main/nevergrad/optimization/oneshot.py">oneshot.py</a>: this is where one-shot optimizers are implemented</p></li>
<li><p><a class="reference external" href="https://github.com/facebookresearch/nevergrad/blob/main/nevergrad/optimization/differentialevolution.py">differentialevolution.py</a>: this is where differential evolution algorithms are implemented.</p></li>
<li><p><a class="reference external" href="https://github.com/facebookresearch/nevergrad/blob/main/nevergrad/optimization/recastlib.py">recastlib.py</a>: this is where we implement ask &amp; tell versions of existing Python implementations which do not follow this pattern. The underlying class which helps spawn a subprocess to run the existing implementation into is in <a class="reference external" href="https://github.com/facebookresearch/nevergrad/blob/main/nevergrad/optimization/recaster.py">recaster.py</a>. Hopefully, you won’t need this.</p></li>
</ul>
<p>If you implement one new algorithm and if this algorithm is not one-shot/evolutionary/recast, you should implement it into <a class="reference external" href="https://github.com/facebookresearch/nevergrad/blob/main/nevergrad/optimization/optimizerlib.py">optimizerlib.py</a>. If you implement a whole family of algorithms, you are welcome to create a new corresponding file.
Still, this structure is not final, it is bound to evolve and you are welcome to amend it.</p>
</section>
<section id="how-to-implement-it">
<h3>How to implement it?<a class="headerlink" href="#how-to-implement-it" title="Link to this heading"></a></h3>
<section id="base-class-features">
<h4>Base class features<a class="headerlink" href="#base-class-features" title="Link to this heading"></a></h4>
<p>All algorithms derive from a base class named <code class="code docutils literal notranslate"><span class="pre">Optimizer</span></code> and are registered through a decorator. The implementation of the base class is <a class="reference external" href="https://github.com/facebookresearch/nevergrad/blob/main/nevergrad/optimization/base.py">here</a>.
This base class implements the <code class="code docutils literal notranslate"><span class="pre">ask</span></code> and <code class="code docutils literal notranslate"><span class="pre">tell</span></code> interface.</p>
<p>It records a sample of the best evaluated points through the <code class="code docutils literal notranslate"><span class="pre">archive</span></code> attribute of class <code class="code docutils literal notranslate"><span class="pre">Archive</span></code>.  The archive can be seen be used as if it was of type
<code class="code docutils literal notranslate"><span class="pre">Dict[np.ndarray,</span> <span class="pre">Value]</span></code>, but since <code class="code docutils literal notranslate"><span class="pre">np.ndarray</span></code> are not hashable, the underlying implementation converts arrays into bytes and
register them into the <code class="code docutils literal notranslate"><span class="pre">archive.bytesdict</span></code> dictionary. <code class="code docutils literal notranslate"><span class="pre">Archive</span></code> however does not implement <code class="code docutils literal notranslate"><span class="pre">keys</span></code> and <code class="code docutils literal notranslate"><span class="pre">items</span></code> methods
because converting from bytes to array is not very efficient, one should therefore integrate on <code class="code docutils literal notranslate"><span class="pre">bytesdict</span></code> and the keys can then be
transformed back to arrays using <code class="code docutils literal notranslate"><span class="pre">np.frombuffer(key)</span></code>. See
<a class="reference external" href="https://github.com/facebookresearch/nevergrad/blob/main/nevergrad/optimization/optimizerlib.py">OnePlusOne implementation</a> for an example.</p>
<p>The key tuple if the point location, and <code class="code docutils literal notranslate"><span class="pre">Value</span></code> is a class with attributes:</p>
<ul class="simple">
<li><p><code class="code docutils literal notranslate"><span class="pre">count</span></code>: number of evaluations at this point.</p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">mean</span></code>: mean value of the evaluations at this point.</p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">variance</span></code>: variance of the evaluations at this point.</p></li>
</ul>
<p>For more details, see the implementation in <a class="reference external" href="https://github.com/facebookresearch/nevergrad/blob/main/nevergrad/optimization/utils.py">utils.py</a>.</p>
<p>Through the archive, you can therefore access most useful information about past evaluations. A pruning mechanism makes sure this archive does
not grow too much. This pruning can be tuned through the <code class="code docutils literal notranslate"><span class="pre">pruning</span></code> attribute of the optimizer.
By default it keeps at least the best 100 points and cleans up when reaching 1000 points. It can be straightforwardly deactivated by setting optimizer’s archive
attribute to <code class="code docutils literal notranslate"><span class="pre">None</span></code>.</p>
<p>The base <code class="code docutils literal notranslate"><span class="pre">Optimizer</span></code> class also tracks the best optimistic and pessimistic points through the <code class="code docutils literal notranslate"><span class="pre">current_bests</span></code> attribute which is of type:
<code class="code docutils literal notranslate"><span class="pre">Dict[str,</span> <span class="pre">Point]</span></code>. The key string is either <code class="code docutils literal notranslate"><span class="pre">optimistic</span></code> or <code class="code docutils literal notranslate"><span class="pre">pessimistic</span></code>, and the <code class="code docutils literal notranslate"><span class="pre">Point</span></code> value is a <code class="code docutils literal notranslate"><span class="pre">Value</span></code> with an additional <code class="code docutils literal notranslate"><span class="pre">x</span></code> attribute, recording the location of the point.</p>
</section>
<section id="methods-and-attributes">
<h4>Methods and attributes<a class="headerlink" href="#methods-and-attributes" title="Link to this heading"></a></h4>
<p>4 methods are designed to be overridden:</p>
<ul class="simple">
<li><p><code class="code docutils literal notranslate"><span class="pre">__init__</span></code>: for the initialization of your algorithm</p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">_internal_ask_candidate</span></code>: to fetch the next point to be evaluated. This function is the only one that is absolutely required to be overridden. The default <code class="code docutils literal notranslate"><span class="pre">ask</span></code> method calls this method (please do not override the default <code class="code docutils literal notranslate"><span class="pre">ask</span></code>).</p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">_internal_tell_candidate</span></code>: to update your algorithm with the new point. The default <code class="code docutils literal notranslate"><span class="pre">tell</span></code> method calls this internal method after updating the archive (see paragraph above), please do not override it.</p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">_internal_provide_recommendation</span></code>: to provide the final recommendation. By default, the recommendation is the pessimistic best point.</p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">_internal_tell_not_asked</span></code> (optional): if the optimizer must handle points differently if they were not asked for, this method must be implemented. If you do not want to support this, you can raise <code class="code docutils literal notranslate"><span class="pre">base.TellNotAskedNotSupportedError</span></code>. A unit test will make sure that the optimizer either accepts the point or raises this error.</p></li>
</ul>
<p>These functions work with <code class="code docutils literal notranslate"><span class="pre">Parameter</span></code> instances, which hold the parameter(s) <code class="code docutils literal notranslate"><span class="pre">value</span></code> (which can also be accessed through <code class="code docutils literal notranslate"><span class="pre">args</span></code> and <code class="code docutils literal notranslate"><span class="pre">kwargs</span></code>) depending on the parametrization provided at the initialization of the optimizer.
New instances of <code class="code docutils literal notranslate"><span class="pre">Parameter</span></code> can be easily created through the <code class="code docutils literal notranslate"><span class="pre">optimizer.parametrization.spawn_child()</span></code>. This way it keeps track of the
filiation between parameters. The value can then be updated either directly through the <code class="code docutils literal notranslate"><span class="pre">parameter.value</span></code> attribute, or by setting
the value in the “standardized space” (<cite>parameter.set_standardized_data</cite>).</p>
<p>If the algorithm is not able to handle parallelization (if <code class="code docutils literal notranslate"><span class="pre">ask</span></code> cannot be called multiple times consecutively), the <code class="code docutils literal notranslate"><span class="pre">no_parallelization</span></code> <strong>class attribute</strong> must be set to <code class="code docutils literal notranslate"><span class="pre">True</span></code>.</p>
</section>
<section id="seeding">
<h4>Seeding<a class="headerlink" href="#seeding" title="Link to this heading"></a></h4>
<p>Seeding has an important part for the significance and reproducibility of the algorithm benchmarking. We want to ensure the following constraints:</p>
<ul class="simple">
<li><p>we expect stochastic algorithms to be actually stochastic, if we set a hard seed inside the implementation this assumption is broken.</p></li>
<li><p>we need the randomness to obtain relevant statistics when benchmarking the algorithms on deterministic functions.</p></li>
<li><p>we should be able to seed from <strong>outside</strong> when we need it: we expect that setting a seed to the global random state should lead to reproducible results.</p></li>
</ul>
<p>In order to facilitate these behaviors, each parametrization has a <code class="code docutils literal notranslate"><span class="pre">random_state</span></code> attribute (<cite>np.random.RandomState</cite>), which can be seeded by the
user if need be. <code class="code docutils literal notranslate"><span class="pre">optimizer._rng</span></code> is a shortcut to access it. All calls to stochastic functions should there be made through it.
By default, it will be seeded randomly by drawing a number from the global numpy random state so
that seeding the global numpy random state will yield reproducible results as well</p>
<p>A unit tests automatically makes sure that all optimizers have repeatable behaviors  on a simple test case when seeded from outside (see below).</p>
</section>
<section id="about-type-hints">
<h4>About type hints<a class="headerlink" href="#about-type-hints" title="Link to this heading"></a></h4>
<p>We have used <a class="reference external" href="https://docs.python.org/3/library/typing.html">type hints</a> throughout <code class="code docutils literal notranslate"><span class="pre">nevergrad</span></code> to make it more robust, and the continuous integration will check that everything is correct when pull requests are submitted.
If you need to add base types for your code, please import them through <code class="code docutils literal notranslate"><span class="pre">import</span> <span class="pre">nevergrad.common.typing</span> <span class="pre">as</span> <span class="pre">tp</span></code>.
However, <strong>we do not want typing to be an annoyance</strong> for contributors who do not care about it, so please feel entirely free to use <code class="code docutils literal notranslate"><span class="pre">#</span> <span class="pre">type:</span> <span class="pre">ignore</span></code> on each line the continuous integration will flag as incorrect, so that the errors disappear. If we consider it useful to have correct typing, we will update the code after your pull request is merged.</p>
</section>
<section id="optimizer-families">
<h4>Optimizer families<a class="headerlink" href="#optimizer-families" title="Link to this heading"></a></h4>
<p>If it makes sense to create several variations of your optimizer, using different hyperparameters, you can implement an <code class="code docutils literal notranslate"><span class="pre">OptimizerFamily</span></code>. The only aim of this class is to create <code class="code docutils literal notranslate"><span class="pre">Optimizers</span></code> and set the parameters before returning it. This is still an experimental API which may evolve soon, and an example can be found in the implementation of <a class="reference external" href="https://github.com/facebookresearch/nevergrad/blob/main/nevergrad/optimization/differentialevolution.py">differential evolution algorithms</a>.</p>
</section>
</section>
<section id="how-to-test-it">
<h3>How to test it<a class="headerlink" href="#how-to-test-it" title="Link to this heading"></a></h3>
<p>You are welcome to add tests if you want to make sure your implementation is correct. It is however not required since some tests are run on all registered algorithms. They will test two features:</p>
<ul class="simple">
<li><p>that all algorithms are able to find the optimum of a simple 2-variable quadratic fitness function.</p></li>
<li><p>that running the algorithms twice after setting a seed lead to the exact same recommendation. This is useful to make sure we will get repeatability in the benchmarks.</p></li>
</ul>
<p>To run these tests, you can use:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pytest<span class="w"> </span>nevergrad/optimization/test_optimizerlib.py
</pre></div>
</div>
<p>The repeatability test will however crash the first time you run it, since no value for the recommendation of your algorithm exists. This is automatically added when running the tests, and if everything goes well the second time you run them, it means everything is fine. You will see in you diff that an additional line was added to a file containing all expected recommendations.</p>
<p>If for any reason one of this test is not suitable for your algorithm, we’ll discuss this in the pull request and decide of the appropriate workaround.</p>
</section>
<section id="how-to-benchmark-it">
<h3>How to benchmark it<a class="headerlink" href="#how-to-benchmark-it" title="Link to this heading"></a></h3>
<p>Benchmarks are implemented in two files <a class="reference external" href="https://github.com/facebookresearch/nevergrad/blob/main/nevergrad/benchmark/experiments.py">experiments.py</a> and <a class="reference external" href="https://github.com/facebookresearch/nevergrad/blob/main/nevergrad/benchmark/frozenexperiments.py">frozenexperiments.py</a>.
While the former can be freely modified (benchmarks will be regularly added and removed), the latter file implements experiments which should not be modified when adding an algorithm, because they are used in tests, or for reproducibility of published results.</p>
<p>Providing some benchmark results along your pull requests will highlight the interest of your algorithm. It is however not required. For now, there is no standard approach for benchmarking your algorithm. You can implement your own benchmark, or copy an existing one and add your algorithm. Feel free to propose other solutions.</p>
<section id="how-benchmarks-are-implemented">
<h4>How benchmarks are implemented<a class="headerlink" href="#how-benchmarks-are-implemented" title="Link to this heading"></a></h4>
<p>A benchmark is made of many <code class="code docutils literal notranslate"><span class="pre">Experiment</span></code> instances.  An <code class="code docutils literal notranslate"><span class="pre">Experiment</span></code> is basically the combination of a test function, and settings for the optimization (optimizer, budget, etc…).</p>
<p>Benchmarks are specified using a generator of <code class="code docutils literal notranslate"><span class="pre">Experiment</span></code> instances. See examples in <a class="reference external" href="https://github.com/facebookresearch/nevergrad/blob/main/nevergrad/benchmark/experiments.py">experiments.py</a>. If you want to make sure your benchmark is perfectly reproducible, you will need to be careful of properly seeding the functions and/or the experiments.</p>
</section>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="benchmarking.html" class="btn btn-neutral float-left" title="Running algorithm benchmarks" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="opencompetition2020.html" class="btn btn-neutral float-right" title="Open Optimization Competition 2020" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2019, Facebook AI Research.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>